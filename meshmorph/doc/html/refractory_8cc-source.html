<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>meshmorph: refractory.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>refractory.cc</h1><a href="refractory_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "<a class="code" href="refractory_8h.html">refractory.h</a>"</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="preprocessor">#include "<a class="code" href="container_8h.html">container.h</a>"</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="edge_8h.html">edge.h</a>"</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include "<a class="code" href="face_8h.html">face.h</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "<a class="code" href="gain__schedule_8h.html">gain_schedule.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="intersecting__faces_8h.html">intersecting_faces.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include "<a class="code" href="object_8h.html">object.h</a>"</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include "<a class="code" href="state_8h.html">state.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="vertex_8h.html">vertex.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="vertex__schedule_8h.html">vertex_schedule.h</a>"</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="keyword">using</span> std::cout;
<a name="l00017"></a>00017 <span class="keyword">using</span> std::endl;
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <a class="code" href="classRefractory.html">Refractory</a> * Refractory::only_one = NULL;
<a name="l00020"></a>00020 
<a name="l00021"></a><a class="code" href="classRefractory.html#5c2c61e4313547213a521ae1d106b7b8">00021</a> <a class="code" href="classRefractory.html">Refractory</a> &amp; <a class="code" href="classRefractory.html#5c2c61e4313547213a521ae1d106b7b8">Refractory::instance</a>()
<a name="l00022"></a>00022 {
<a name="l00023"></a>00023   <span class="comment">// Not thread-safe.</span>
<a name="l00024"></a>00024   <span class="comment">// -- lock mutex</span>
<a name="l00025"></a>00025   <span class="keywordflow">if</span> (only_one == NULL)
<a name="l00026"></a>00026     only_one = <span class="keyword">new</span> <a class="code" href="classRefractory.html">Refractory</a>();
<a name="l00027"></a>00027   <span class="comment">// -- unlock mutex</span>
<a name="l00028"></a>00028   <span class="keywordflow">return</span> *only_one;
<a name="l00029"></a>00029 }
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 Refractory::Refractory (<span class="keyword">const</span> <a class="code" href="classRefractory.html">Refractory</a>&amp; rhs)
<a name="l00032"></a>00032   :refrac_s(),refrac_l(),pun_n(),pun_int(),
<a name="l00033"></a>00033   pun_ang(),pun_com(),touch_map()
<a name="l00034"></a>00034 {
<a name="l00035"></a>00035   cout &lt;&lt; <span class="stringliteral">"Copy constructor prohibited on instances of Refractory class.\n"</span>;
<a name="l00036"></a>00036   cout &lt;&lt; <span class="stringliteral">"Refractory "</span> &lt;&lt; rhs.<a class="code" href="classRefractory.html#f459e01a010940b8d16d51ca716a5f37">touch_map</a>.size() &lt;&lt; endl;
<a name="l00037"></a>00037   exit(0);
<a name="l00038"></a>00038 }
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 Refractory::Refractory (<span class="keywordtype">void</span>)
<a name="l00041"></a>00041   :refrac_s(),refrac_l(),pun_n(),pun_int(),
<a name="l00042"></a>00042   pun_ang(),pun_com(),touch_map()
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044 }
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <a class="code" href="classRefractory.html">Refractory</a>&amp; Refractory::operator= (<span class="keyword">const</span> <a class="code" href="classRefractory.html">Refractory</a>&amp; rhs)
<a name="l00047"></a>00047 {
<a name="l00048"></a>00048   cout &lt;&lt; <span class="stringliteral">"Copy assignment operator prohibited on instances of Refractory class.\n"</span>;
<a name="l00049"></a>00049   cout &lt;&lt; <span class="stringliteral">"Refractory "</span> &lt;&lt; rhs.<a class="code" href="classRefractory.html#f459e01a010940b8d16d51ca716a5f37">touch_map</a>.size() &lt;&lt; endl;
<a name="l00050"></a>00050   exit(0);
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="classRefractory.html#292e32fa5fa3934d991cd0e321f576c7">00053</a> <span class="keywordtype">bool</span> <a class="code" href="classRefractory.html#292e32fa5fa3934d991cd0e321f576c7">Refractory::isPunished</a> (<a class="code" href="classVertex.html">Vertex</a> * <span class="keyword">const</span> v)
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055   <span class="keywordflow">return</span> (pun_n.find(v)!=pun_n.end() ||
<a name="l00056"></a>00056           pun_int.find(v)!=pun_int.end() ||
<a name="l00057"></a>00057           pun_com.find(v)!=pun_com.end() || 
<a name="l00058"></a>00058           pun_ang.find(v)!=pun_ang.end());
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="classRefractory.html#c920b5f7c7066337cee64b6f4cc8db37">00061</a> <span class="keywordtype">void</span> <a class="code" href="classRefractory.html#c920b5f7c7066337cee64b6f4cc8db37">Refractory::punishN</a> (<a class="code" href="classVertex.html">Vertex</a> * <span class="keyword">const</span> v,<span class="keywordtype">int</span> <span class="keyword">const</span> time_out)
<a name="l00062"></a>00062 {
<a name="l00063"></a>00063   pun_n[v]=time_out;
<a name="l00064"></a>00064 }
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="classRefractory.html#01e80a0fe27a2946222abb7d0e0feea2">00066</a> <span class="keywordtype">void</span> <a class="code" href="classRefractory.html#01e80a0fe27a2946222abb7d0e0feea2">Refractory::punishInt</a> (<a class="code" href="classVertex.html">Vertex</a> * <span class="keyword">const</span> v,<span class="keywordtype">int</span> <span class="keyword">const</span> time_out)
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068   pun_int[v]=time_out;
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="classRefractory.html#d877e3de386487de7dc0951850fb69cd">00071</a> <span class="keywordtype">void</span> <a class="code" href="classRefractory.html#d877e3de386487de7dc0951850fb69cd">Refractory::punishCom</a> (<a class="code" href="classVertex.html">Vertex</a> * <span class="keyword">const</span> v,<span class="keywordtype">int</span> <span class="keyword">const</span> time_out)
<a name="l00072"></a>00072 {
<a name="l00073"></a>00073   pun_com[v]=time_out;
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="classRefractory.html#5c57cbfa92bbaa699599fce12ca300d3">00076</a> <span class="keywordtype">void</span> <a class="code" href="classRefractory.html#5c57cbfa92bbaa699599fce12ca300d3">Refractory::punishAng</a> (<a class="code" href="classVertex.html">Vertex</a> *v,<span class="keywordtype">int</span> time_out)
<a name="l00077"></a>00077 {
<a name="l00078"></a>00078   pun_ang[v]=time_out;
<a name="l00079"></a>00079 }
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="classRefractory.html#090ffb8adf5933370284522efd0b1885">00081</a> <span class="keywordtype">void</span> <a class="code" href="classRefractory.html#090ffb8adf5933370284522efd0b1885">Refractory::updateTouchMap</a> (<a class="code" href="classVertex.html">Vertex</a> * <span class="keyword">const</span> v)
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083   <span class="comment">// if vertex in touch_map, then increment</span>
<a name="l00084"></a>00084   <span class="keywordflow">if</span>(touch_map.find(v)!=touch_map.end()){ touch_map[v]++; }
<a name="l00085"></a>00085   <span class="comment">// else init to one touch</span>
<a name="l00086"></a>00086   <span class="keywordflow">else</span> { touch_map[v]=1; }
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="classRefractory.html#3139a8605cc0493cdd1f49e45980514c">00089</a> <span class="keywordtype">void</span> <a class="code" href="classRefractory.html#3139a8605cc0493cdd1f49e45980514c">Refractory::punishIfOverTouched</a> (<a class="code" href="classVertex.html">Vertex</a> * <span class="keyword">const</span> v)
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091   <span class="comment">// if vertex touched too much</span>
<a name="l00092"></a>00092   <span class="keywordflow">if</span>(touch_map[v]&gt;<a class="code" href="controls_8h.html#b5d27c1ff0a05f1eb964e81da504b521">MAX_TOUCHES</a>){<a class="code" href="classRefractory.html#c920b5f7c7066337cee64b6f4cc8db37">punishN</a>(v,static_cast&lt;int&gt;(<a class="code" href="controls_8h.html#b1b1c402e77ebad55cb64e1ed1fc3466">GROUP_SIZE</a>));}
<a name="l00093"></a>00093 }
<a name="l00094"></a>00094 
<a name="l00095"></a><a class="code" href="classRefractory.html#e06426b8b6b1f304a35972354c5e7a1a">00095</a> <span class="keywordtype">void</span> <a class="code" href="classRefractory.html#e06426b8b6b1f304a35972354c5e7a1a">Refractory::initRefrac</a> (<span class="keywordtype">void</span>)
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097   refrac_s.clear();
<a name="l00098"></a>00098   refrac_l.clear();
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="classRefractory.html#da7e37aae974e130e6db28b56866f3bd">00101</a> <span class="keywordtype">bool</span> <a class="code" href="classRefractory.html#da7e37aae974e130e6db28b56866f3bd">Refractory::Refracted</a> (<a class="code" href="classVertex.html">Vertex</a> * <span class="keyword">const</span> v)
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103   <span class="keywordflow">if</span> (refrac_s.find(v)!=refrac_s.end()){<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00104"></a>00104   <span class="keywordflow">else</span>  {<span class="keywordflow">return</span> <span class="keyword">false</span>;}
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 
<a name="l00107"></a><a class="code" href="classRefractory.html#49bdedf36f82a5fc28faf369b5484867">00107</a> <span class="keywordtype">void</span> <a class="code" href="classRefractory.html#49bdedf36f82a5fc28faf369b5484867">Refractory::updateRefractoryWindow</a> (<a class="code" href="classVertex.html">Vertex</a> * <span class="keyword">const</span> v)
<a name="l00108"></a>00108 {
<a name="l00110"></a>00110   <span class="keywordflow">if</span>(refrac_l.size()==<a class="code" href="controls_8h.html#1787e7708689f447c5cf94cca3621c77">REFRACTORY_PERIOD</a>)
<a name="l00111"></a>00111   {
<a name="l00112"></a>00112     refrac_s.erase(refrac_l.front());
<a name="l00113"></a>00113     refrac_l.pop_front();
<a name="l00114"></a>00114   }
<a name="l00116"></a>00116   refrac_l.push_back(v);
<a name="l00117"></a>00117   refrac_s.insert(v);
<a name="l00118"></a>00118 }
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="classRefractory.html#085b1700e2281d6a63762f0cd542ac70">00120</a> <span class="keywordtype">bool</span> <a class="code" href="classRefractory.html#085b1700e2281d6a63762f0cd542ac70">Refractory::vertexIsMoveCandidate</a> (<a class="code" href="classVertex.html">Vertex</a> * <span class="keyword">const</span> v)
<a name="l00121"></a>00121 {
<a name="l00122"></a>00122   <span class="comment">// if vertex is candidate, i.e. closest point was found for vertex</span>
<a name="l00123"></a>00123   <span class="comment">// and vertex not found in refractory list of vertices</span>
<a name="l00124"></a>00124   <span class="comment">// i.e. list of last REFRACTORY_PERIOD (e.g. 1000) vertices moved</span>
<a name="l00125"></a>00125   <span class="comment">// and vertex is not in gate, i.e. failed to move and punished for extent of w group</span>
<a name="l00126"></a>00126   <span class="keywordflow">return</span> (v-&gt;<a class="code" href="classVertex.html#523766c0ba54083986420f0fe2e60036">getFace</a>()!=NULL) &amp;&amp; (<a class="code" href="classRefractory.html#292e32fa5fa3934d991cd0e321f576c7">isPunished</a>(v)==<span class="keyword">false</span>) &amp;&amp; !<a class="code" href="classRefractory.html#da7e37aae974e130e6db28b56866f3bd">Refracted</a>(v)
<a name="l00127"></a>00127         &amp;&amp; (<a class="code" href="classContainer.html#e4646d7b418a9b302db245f074ad8ec5">Container::instance</a>().<a class="code" href="classContainer.html#3c92a60d35c886a638142e654eee99c8">vertexIsFrozen</a>(v)==<span class="keyword">false</span>);
<a name="l00128"></a>00128 }
<a name="l00129"></a>00129 
<a name="l00130"></a><a class="code" href="classRefractory.html#f8308331f39ef0f4d44e4a242c890ca6">00130</a> <span class="keywordtype">void</span> <a class="code" href="classRefractory.html#f8308331f39ef0f4d44e4a242c890ca6">Refractory::screenDisp</a> (<a class="code" href="classVertex.html">Vertex</a> * <span class="keyword">const</span> ccvv,<a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> &amp; PT)
<a name="l00131"></a>00131 {
<a name="l00132"></a>00132   <span class="comment">// square of displacement</span>
<a name="l00133"></a>00133   <span class="keywordtype">double</span> d[3]={PT[0]-ccvv-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(0),PT[1]-ccvv-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(1),PT[2]-ccvv-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(2)};
<a name="l00134"></a>00134   <span class="comment">//double sqdisp = d[0]*d[0]+d[1]*d[1]+d[2]*d[2];</span>
<a name="l00135"></a>00135   <span class="keywordtype">double</span> disp = sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);
<a name="l00136"></a>00136   <span class="comment">// compute max allowed displacement</span>
<a name="l00137"></a>00137   <span class="keywordtype">double</span> min_edge_length = 1e30;
<a name="l00138"></a>00138   <span class="comment">// for each adjacent face</span>
<a name="l00139"></a>00139   <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#8d2bcc70fbd9a2cca7eecb128703e8c7">fp_cit</a> i=ccvv-&gt;<a class="code" href="classVertex.html#7ebc259c68c71408ecc67662d64e9ec0">begin</a>();i!=ccvv-&gt;<a class="code" href="classVertex.html#4bb81e4284f35a668f19495419a23abb">end</a>();i++)
<a name="l00140"></a>00140   {
<a name="l00141"></a>00141     <span class="comment">// find shortest edge</span>
<a name="l00142"></a>00142     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;j++)
<a name="l00143"></a>00143     {
<a name="l00144"></a>00144       <span class="keywordflow">if</span>((*i)-&gt;getEdge(j)-&gt;getOriginalLength() &lt; min_edge_length)
<a name="l00145"></a>00145       {
<a name="l00146"></a>00146         min_edge_length = (*i)-&gt;getEdge(j)-&gt;getOriginalLength();
<a name="l00147"></a>00147       }
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149   }
<a name="l00150"></a>00150   <span class="keywordtype">double</span> MAX_ACTUAL_DISPL = min_edge_length*<a class="code" href="controls_8h.html#37924f9888bb6c711111503325bb25e7">MAX_ACTUAL_DISPL_FRACTION</a>;
<a name="l00151"></a>00151   <span class="comment">// if too big</span>
<a name="l00152"></a>00152   <span class="keywordflow">if</span>(disp&gt;MAX_ACTUAL_DISPL)
<a name="l00153"></a>00153   {
<a name="l00154"></a>00154     <span class="keywordtype">double</span> a = MAX_ACTUAL_DISPL/disp;
<a name="l00155"></a>00155     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;3;k++)
<a name="l00156"></a>00156     {
<a name="l00157"></a>00157       PT[k] = ccvv-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(k)+a*d[k];
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159   }
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="classRefractory.html#9dfb492cfe462fafb62e15bd400d445d">00162</a> <a class="code" href="meshmorph_8h.html#0a71b31dd39130cbd3fd1fa15d7fefe1">vp_cit</a> <a class="code" href="classRefractory.html#9dfb492cfe462fafb62e15bd400d445d">Refractory::detectPunishableVertex</a> (<a class="code" href="meshmorph_8h.html#0a71b31dd39130cbd3fd1fa15d7fefe1">vp_cit</a> i,<span class="keywordtype">bool</span> <span class="keyword">const</span> int_flag,<span class="keywordtype">bool</span> <span class="keyword">const</span> ang_flag)
<a name="l00163"></a>00163 {
<a name="l00164"></a>00164   <span class="keywordflow">if</span>(<a class="code" href="classState.html#cd3aa3488c0124d7d4774ff0f7250685">State::instance</a>().getVD2()&lt;<a class="code" href="controls_8h.html#2fee5847ba80d7856d41c703cab6dbc4">MIN_DISPLACEMENT_SQ</a>*<a class="code" href="controls_8h.html#4f159bf187491542eb50806dfdc1110f">SCALE</a>*<a class="code" href="controls_8h.html#4f159bf187491542eb50806dfdc1110f">SCALE</a>)
<a name="l00165"></a>00165   {
<a name="l00166"></a>00166     cout &lt;&lt; <span class="stringliteral">"\nvertex: "</span> &lt;&lt; <a class="code" href="classVertex__Schedule.html#73029813663350a537c863c67976bcb6">Vertex_Schedule::instance</a>().<a class="code" href="classVertex__Schedule.html#95a6847f8121f872b1bcf4798a1d0d83">getCurrentVertex</a>()-&gt;<a class="code" href="classVertex.html#9f5e25fd8be3ea577b4fc36069e1179d">getObject</a>()-&gt;<a class="code" href="classObject.html#cc8484b3d564307b5bd801b907b0d72f">getName</a>() &lt;&lt; <span class="stringliteral">"-&gt;"</span> &lt;&lt; <a class="code" href="classVertex__Schedule.html#73029813663350a537c863c67976bcb6">Vertex_Schedule::instance</a>().<a class="code" href="classVertex__Schedule.html#95a6847f8121f872b1bcf4798a1d0d83">getCurrentVertex</a>()-&gt;<a class="code" href="classVertex.html#0487c340a3a1559f4a8e45d8a7b0f9e2">getIndex</a>() &lt;&lt; <span class="stringliteral">" was punished.\n"</span>
<a name="l00167"></a>00167           &lt;&lt; <span class="stringliteral">"virtual displacement sqd("</span> &lt;&lt; <a class="code" href="classState.html#cd3aa3488c0124d7d4774ff0f7250685">State::instance</a>().<a class="code" href="classState.html#764ce2e15b97118a2b621bd5b379426a">getVD2</a>() &lt;&lt; <span class="stringliteral">")"</span>
<a name="l00168"></a>00168           &lt;&lt; <span class="stringliteral">" &lt; threshold("</span> &lt;&lt; <a class="code" href="controls_8h.html#2fee5847ba80d7856d41c703cab6dbc4">MIN_DISPLACEMENT_SQ</a>*SCALE*SCALE &lt;&lt; <span class="stringliteral">")\n"</span>;
<a name="l00169"></a>00169     <a class="code" href="classVertex__Schedule.html#73029813663350a537c863c67976bcb6">Vertex_Schedule::instance</a>().<a class="code" href="classVertex__Schedule.html#95a6847f8121f872b1bcf4798a1d0d83">getCurrentVertex</a>()-&gt;<a class="code" href="classVertex.html#ef328a4374db75403a25eb165c1b7066">print</a>(std::cout);
<a name="l00170"></a>00170     cout &lt;&lt; endl;
<a name="l00171"></a>00171     <span class="comment">// vertex is effectively immovable, so punish vertex</span>
<a name="l00172"></a>00172     <span class="keywordflow">if</span>     (int_flag==<span class="keyword">true</span>){ <a class="code" href="classRefractory.html#01e80a0fe27a2946222abb7d0e0feea2">punishInt</a>(<a class="code" href="classVertex__Schedule.html#73029813663350a537c863c67976bcb6">Vertex_Schedule::instance</a>().getCurrentVertex(),static_cast&lt;int&gt;(<a class="code" href="controls_8h.html#b1b1c402e77ebad55cb64e1ed1fc3466">GROUP_SIZE</a>));}
<a name="l00173"></a>00173     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ang_flag==<span class="keyword">true</span>){ <a class="code" href="classRefractory.html#5c57cbfa92bbaa699599fce12ca300d3">punishAng</a>(<a class="code" href="classVertex__Schedule.html#73029813663350a537c863c67976bcb6">Vertex_Schedule::instance</a>().getCurrentVertex(),static_cast&lt;int&gt;(<a class="code" href="controls_8h.html#b1b1c402e77ebad55cb64e1ed1fc3466">GROUP_SIZE</a>));}
<a name="l00174"></a>00174     <span class="keywordflow">else</span>                   { <a class="code" href="classRefractory.html#d877e3de386487de7dc0951850fb69cd">punishCom</a>(<a class="code" href="classVertex__Schedule.html#73029813663350a537c863c67976bcb6">Vertex_Schedule::instance</a>().getCurrentVertex(),static_cast&lt;int&gt;(<a class="code" href="controls_8h.html#b1b1c402e77ebad55cb64e1ed1fc3466">GROUP_SIZE</a>));}
<a name="l00175"></a>00175     <span class="comment">// reset gain</span>
<a name="l00176"></a>00176     <a class="code" href="classGain__Schedule.html#e9eeedf767171cf65a3fa1ce7728a48d">Gain_Schedule::instance</a>().<a class="code" href="classGain__Schedule.html#75dcb2056c045ddaf16f3e72db0696ca">resetGain</a>();
<a name="l00177"></a>00177     <span class="comment">// move on to next vertex in set</span>
<a name="l00178"></a>00178     i++;
<a name="l00179"></a>00179   }
<a name="l00180"></a>00180   <span class="keywordflow">else</span>
<a name="l00181"></a>00181   {
<a name="l00182"></a>00182     <span class="comment">// try halving gain to halve attempted virtual displacement and try again</span>
<a name="l00183"></a>00183     <a class="code" href="classGain__Schedule.html#e9eeedf767171cf65a3fa1ce7728a48d">Gain_Schedule::instance</a>().<a class="code" href="classGain__Schedule.html#5fc79542643bd357116aea69735a1ac1">halveGain</a>();
<a name="l00184"></a>00184   }
<a name="l00185"></a>00185   <span class="keywordflow">return</span> i;
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a><a class="code" href="classRefractory.html#f3da31948e871ce9a06d8be2e0e11ae3">00188</a> <span class="keywordtype">void</span> <a class="code" href="classRefractory.html#f3da31948e871ce9a06d8be2e0e11ae3">Refractory::updateStats</a> (<span class="keywordtype">void</span>)
<a name="l00189"></a>00189 {
<a name="l00190"></a>00190   <span class="comment">// automatically strict face intersection prevention</span>
<a name="l00191"></a>00191   <span class="keywordflow">if</span>(<a class="code" href="controls_8h.html#0e7219c0ea3b109ee655aebc8fa4c8bd">STRICT_FACE_INTERSECTION_PREVENTION</a>==<span class="keyword">false</span>)
<a name="l00192"></a>00192   {
<a name="l00193"></a>00193     <span class="keywordflow">if</span>(<a class="code" href="controls_8h.html#375fdbc0f66007d65514cc4b1b761738">DETECT_COMPLETE_SEPARATION</a>==<span class="keyword">true</span>)
<a name="l00194"></a>00194     {
<a name="l00195"></a>00195       <span class="keywordflow">if</span>(<a class="code" href="classIntersecting__Faces.html#8ccec8bb3cfc50e4ad98ff13c1f8ec8f">Intersecting_Faces::instance</a>().getCountOfIntFaces(<span class="keyword">false</span>)==0){<a class="code" href="controls_8h.html#0e7219c0ea3b109ee655aebc8fa4c8bd">STRICT_FACE_INTERSECTION_PREVENTION</a>=<span class="keyword">true</span>;}
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197   }
<a name="l00198"></a>00198   <span class="comment">// increment number of times current vertex has been moved</span>
<a name="l00199"></a>00199   <a class="code" href="classRefractory.html#090ffb8adf5933370284522efd0b1885">updateTouchMap</a>(<a class="code" href="classVertex__Schedule.html#73029813663350a537c863c67976bcb6">Vertex_Schedule::instance</a>().getCurrentVertex());
<a name="l00200"></a>00200   <span class="comment">// punish vertex if moved too many time</span>
<a name="l00201"></a>00201   <a class="code" href="classRefractory.html#3139a8605cc0493cdd1f49e45980514c">punishIfOverTouched</a>(<a class="code" href="classVertex__Schedule.html#73029813663350a537c863c67976bcb6">Vertex_Schedule::instance</a>().getCurrentVertex());
<a name="l00202"></a>00202   <span class="comment">// update list of vertices in refractory period</span>
<a name="l00203"></a>00203   <a class="code" href="classRefractory.html#49bdedf36f82a5fc28faf369b5484867">updateRefractoryWindow</a>(<a class="code" href="classVertex__Schedule.html#73029813663350a537c863c67976bcb6">Vertex_Schedule::instance</a>().getCurrentVertex());
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00206"></a><a class="code" href="classRefractory.html#e1e5e7c0a0b3cd35c9a57c7d69196f62">00206</a> <span class="keywordtype">void</span> <a class="code" href="classRefractory.html#e1e5e7c0a0b3cd35c9a57c7d69196f62">Refractory::groupInit</a> (<span class="keywordtype">void</span>)
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208   <span class="comment">// instantiate list of vertices moved small distance (gate)</span>
<a name="l00209"></a>00209   <span class="comment">// and instantiate refractory period list</span>
<a name="l00210"></a>00210   <a class="code" href="classRefractory.html#e06426b8b6b1f304a35972354c5e7a1a">initRefrac</a>();
<a name="l00211"></a>00211   <span class="comment">// clear punished vertex lists</span>
<a name="l00212"></a>00212   pun_n.clear();
<a name="l00213"></a>00213   pun_int.clear();
<a name="l00214"></a>00214   pun_com.clear();
<a name="l00215"></a>00215   pun_ang.clear();
<a name="l00216"></a>00216   <span class="comment">// initialize map used to track how many times each vertex was moved</span>
<a name="l00217"></a>00217   touch_map.clear();
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00220"></a><a class="code" href="classRefractory.html#2d4b364e8258df1fe6a42d3b9d156038">00220</a> <a class="code" href="meshmorph_8h.html#8bb21ea8b96f25d850160ffd28bea2bb">vhm_it</a> <a class="code" href="classRefractory.html#2d4b364e8258df1fe6a42d3b9d156038">Refractory::findVertexInTouchMap</a> (<a class="code" href="classVertex.html">Vertex</a> *v)
<a name="l00221"></a>00221 {
<a name="l00222"></a>00222   <span class="keywordflow">return</span> touch_map.find(v);
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00225"></a><a class="code" href="classRefractory.html#40b0fef892c49c66bf0225835ce8dd77">00225</a> <span class="keywordtype">bool</span> <a class="code" href="classRefractory.html#40b0fef892c49c66bf0225835ce8dd77">Refractory::vertexInTouchMap</a> (<a class="code" href="classVertex.html">Vertex</a> *v)
<a name="l00226"></a>00226 {
<a name="l00227"></a>00227   <span class="keywordflow">return</span> touch_map.find(v)!=touch_map.end();
<a name="l00228"></a>00228 }
<a name="l00229"></a>00229 
<a name="l00230"></a><a class="code" href="classRefractory.html#2b1e8b8e5589bacfa128d0b372fcd2ee">00230</a> <span class="keywordtype">int</span> <a class="code" href="classRefractory.html#2b1e8b8e5589bacfa128d0b372fcd2ee">Refractory::numVertexTouches</a> (<a class="code" href="classVertex.html">Vertex</a> * v)
<a name="l00231"></a>00231 {
<a name="l00232"></a>00232   <span class="keywordflow">return</span> touch_map[v];
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 
<a name="l00235"></a><a class="code" href="classRefractory.html#1973b1bb51662abcb461beae224c1d05">00235</a> <span class="keywordtype">int</span> <a class="code" href="classRefractory.html#1973b1bb51662abcb461beae224c1d05">Refractory::numPunishedN</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00236"></a>00236 <span class="keyword"></span>{
<a name="l00237"></a>00237   <span class="keywordflow">return</span> pun_n.size();
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 
<a name="l00240"></a><a class="code" href="classRefractory.html#c1ba9c6ecfa91ccb60e05928a5503024">00240</a> <a class="code" href="meshmorph_8h.html#37680d6b8f28499a1aee927e43cb33c1">vhm_cit</a> <a class="code" href="classRefractory.html#c1ba9c6ecfa91ccb60e05928a5503024">Refractory::beginN</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00241"></a>00241 <span class="keyword"></span>{
<a name="l00242"></a>00242   <span class="keywordflow">return</span> pun_n.begin();
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 
<a name="l00245"></a><a class="code" href="classRefractory.html#df953ba6faa72c7c17ef6f1dbcb4399a">00245</a> <a class="code" href="meshmorph_8h.html#37680d6b8f28499a1aee927e43cb33c1">vhm_cit</a> <a class="code" href="classRefractory.html#df953ba6faa72c7c17ef6f1dbcb4399a">Refractory::endN</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00246"></a>00246 <span class="keyword"></span>{
<a name="l00247"></a>00247   <span class="keywordflow">return</span> pun_n.end();
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00250"></a><a class="code" href="classRefractory.html#e1d0d00ede5d7b48b8917e590c8eb49d">00250</a> <span class="keywordtype">int</span> <a class="code" href="classRefractory.html#e1d0d00ede5d7b48b8917e590c8eb49d">Refractory::numPunishedInt</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00251"></a>00251 <span class="keyword"></span>{
<a name="l00252"></a>00252   <span class="keywordflow">return</span> pun_int.size();
<a name="l00253"></a>00253 }
<a name="l00254"></a>00254 
<a name="l00255"></a><a class="code" href="classRefractory.html#691d41340e216375bb8f0be2b2909a72">00255</a> <a class="code" href="meshmorph_8h.html#37680d6b8f28499a1aee927e43cb33c1">vhm_cit</a> <a class="code" href="classRefractory.html#691d41340e216375bb8f0be2b2909a72">Refractory::beginInt</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00256"></a>00256 <span class="keyword"></span>{
<a name="l00257"></a>00257   <span class="keywordflow">return</span> pun_int.begin();
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="classRefractory.html#e5144133bac71491855a2179928e8d4c">00260</a> <a class="code" href="meshmorph_8h.html#37680d6b8f28499a1aee927e43cb33c1">vhm_cit</a> <a class="code" href="classRefractory.html#e5144133bac71491855a2179928e8d4c">Refractory::endInt</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00261"></a>00261 <span class="keyword"></span>{
<a name="l00262"></a>00262   <span class="keywordflow">return</span> pun_int.end();
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00265"></a><a class="code" href="classRefractory.html#67537374460d788279fb047000d556a7">00265</a> <span class="keywordtype">int</span> <a class="code" href="classRefractory.html#67537374460d788279fb047000d556a7">Refractory::numPunishedAng</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00266"></a>00266 <span class="keyword"></span>{
<a name="l00267"></a>00267   <span class="keywordflow">return</span> pun_ang.size();
<a name="l00268"></a>00268 }
<a name="l00269"></a>00269 
<a name="l00270"></a><a class="code" href="classRefractory.html#c683756f99b2d123190773f37df41ee6">00270</a> <a class="code" href="meshmorph_8h.html#37680d6b8f28499a1aee927e43cb33c1">vhm_cit</a> <a class="code" href="classRefractory.html#c683756f99b2d123190773f37df41ee6">Refractory::beginAng</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00271"></a>00271 <span class="keyword"></span>{
<a name="l00272"></a>00272   <span class="keywordflow">return</span> pun_ang.begin();
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a><a class="code" href="classRefractory.html#cd4ce8a425805d5cbf94c7baf82d7b18">00275</a> <a class="code" href="meshmorph_8h.html#37680d6b8f28499a1aee927e43cb33c1">vhm_cit</a> <a class="code" href="classRefractory.html#cd4ce8a425805d5cbf94c7baf82d7b18">Refractory::endAng</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00276"></a>00276 <span class="keyword"></span>{
<a name="l00277"></a>00277   <span class="keywordflow">return</span> pun_ang.end();
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a><a class="code" href="classRefractory.html#5bd41d89d5013bb0af94f12c8902a57a">00280</a> <span class="keywordtype">int</span> <a class="code" href="classRefractory.html#5bd41d89d5013bb0af94f12c8902a57a">Refractory::numPunishedCom</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00281"></a>00281 <span class="keyword"></span>{
<a name="l00282"></a>00282   <span class="keywordflow">return</span> pun_com.size();
<a name="l00283"></a>00283 }
<a name="l00284"></a>00284 
<a name="l00285"></a><a class="code" href="classRefractory.html#0cdc0e99c4d4651c4017e3397babf5e7">00285</a> <a class="code" href="meshmorph_8h.html#37680d6b8f28499a1aee927e43cb33c1">vhm_cit</a> <a class="code" href="classRefractory.html#0cdc0e99c4d4651c4017e3397babf5e7">Refractory::beginCom</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00286"></a>00286 <span class="keyword"></span>{
<a name="l00287"></a>00287   <span class="keywordflow">return</span> pun_com.begin();
<a name="l00288"></a>00288 }
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="classRefractory.html#9b66fea59c28c6ca78cfc880384b2b58">00290</a> <a class="code" href="meshmorph_8h.html#37680d6b8f28499a1aee927e43cb33c1">vhm_cit</a> <a class="code" href="classRefractory.html#9b66fea59c28c6ca78cfc880384b2b58">Refractory::endCom</a> (<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00291"></a>00291 <span class="keyword"></span>{
<a name="l00292"></a>00292   <span class="keywordflow">return</span> pun_com.end();
<a name="l00293"></a>00293 }
<a name="l00294"></a>00294 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Jul 18 19:43:40 2008 for meshmorph by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
