<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>meshmorph: intersecting_faces.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>intersecting_faces.cc</h1><a href="intersecting__faces_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "<a class="code" href="intersecting__faces_8h.html">intersecting_faces.h</a>"</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="box_8h.html">box.h</a>"</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include "<a class="code" href="container_8h.html">container.h</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "<a class="code" href="face_8h.html">face.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="misc_8h.html">misc.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include "<a class="code" href="nice_8h.html">nice.h</a>"</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include "<a class="code" href="object_8h.html">object.h</a>"</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="space_8h.html">space.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="state_8h.html">state.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="vertex_8h.html">vertex.h</a>"</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="keyword">using</span> std::cout;
<a name="l00018"></a>00018 <span class="keyword">using</span> std::endl;
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <a class="code" href="classIntersecting__Faces.html">Intersecting_Faces</a> * Intersecting_Faces::only_one = NULL;
<a name="l00021"></a>00021 
<a name="l00022"></a><a class="code" href="classIntersecting__Faces.html#8ccec8bb3cfc50e4ad98ff13c1f8ec8f">00022</a> <a class="code" href="classIntersecting__Faces.html">Intersecting_Faces</a> &amp; <a class="code" href="classIntersecting__Faces.html#8ccec8bb3cfc50e4ad98ff13c1f8ec8f">Intersecting_Faces::instance</a>(<span class="keywordtype">void</span>)
<a name="l00023"></a>00023 {
<a name="l00024"></a>00024   <span class="comment">// Not thread-safe.</span>
<a name="l00025"></a>00025   <span class="comment">// -- lock mutex</span>
<a name="l00026"></a>00026   <span class="keywordflow">if</span> (only_one == NULL)
<a name="l00027"></a>00027     only_one = <span class="keyword">new</span> <a class="code" href="classIntersecting__Faces.html">Intersecting_Faces</a>();
<a name="l00028"></a>00028   <span class="comment">// -- unlock mutex</span>
<a name="l00029"></a>00029   <span class="keywordflow">return</span> *only_one;
<a name="l00030"></a>00030 }
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <a class="code" href="classIntersecting__Faces.html">Intersecting_Faces</a>&amp; Intersecting_Faces::operator= (<span class="keyword">const</span> <a class="code" href="classIntersecting__Faces.html">Intersecting_Faces</a>&amp; rhs)
<a name="l00033"></a>00033 {
<a name="l00034"></a>00034   cout &lt;&lt; <span class="stringliteral">"Copy assignment operator prohibited on instances of Intersecting_Faces class.\n"</span>;
<a name="l00035"></a>00035   cout &lt;&lt; <span class="stringliteral">"Intersecting_Faces "</span> &lt;&lt; rhs.<a class="code" href="classIntersecting__Faces.html#11149b0f7ff3b651edafe33bba6dbf08">intf</a>.size() &lt;&lt; endl;
<a name="l00036"></a>00036   exit(0);
<a name="l00037"></a>00037 }
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 Intersecting_Faces::Intersecting_Faces (<span class="keywordtype">void</span>)
<a name="l00040"></a>00040   :intf()
<a name="l00041"></a>00041 {
<a name="l00042"></a>00042 }
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 Intersecting_Faces::Intersecting_Faces (<span class="keyword">const</span> <a class="code" href="classIntersecting__Faces.html">Intersecting_Faces</a> &amp; rhs)
<a name="l00045"></a>00045   :intf()
<a name="l00046"></a>00046 {
<a name="l00047"></a>00047   cout &lt;&lt; <span class="stringliteral">"Copy constructor prohibited on instances of Intersecting_Faces class.\n"</span>;
<a name="l00048"></a>00048   cout &lt;&lt; <span class="stringliteral">"Intersecting_Faces "</span> &lt;&lt; rhs.<a class="code" href="classIntersecting__Faces.html#11149b0f7ff3b651edafe33bba6dbf08">intf</a>.size() &lt;&lt; endl;
<a name="l00049"></a>00049   exit(0);
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="classIntersecting__Faces.html#3001ff5e44da230f952f7c0c9e23ce0c">00052</a> <a class="code" href="meshmorph_8h.html#d54c98d3b6edd701bc42d29ceb0aca87">htff_cit</a> <a class="code" href="classIntersecting__Faces.html#3001ff5e44da230f952f7c0c9e23ce0c">Intersecting_Faces::begin</a> (<span class="keywordtype">void</span>)
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054   <span class="keywordflow">return</span> intf.begin();
<a name="l00055"></a>00055 }
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="classIntersecting__Faces.html#5d2b8047ec822cad682ac0bdfff3b0d2">00057</a> <a class="code" href="meshmorph_8h.html#d54c98d3b6edd701bc42d29ceb0aca87">htff_cit</a> <a class="code" href="classIntersecting__Faces.html#5d2b8047ec822cad682ac0bdfff3b0d2">Intersecting_Faces::end</a> (<span class="keywordtype">void</span>)
<a name="l00058"></a>00058 {
<a name="l00059"></a>00059   <span class="keywordflow">return</span> intf.end();
<a name="l00060"></a>00060 }
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="classIntersecting__Faces.html#293abeb5536fd3d69c82f44775d28396">00062</a> <a class="code" href="meshmorph_8h.html#1f34905de522641c355a51fe9e3f1149">vec_fp</a> * <a class="code" href="classIntersecting__Faces.html#293abeb5536fd3d69c82f44775d28396">Intersecting_Faces::getIntersectingFacesRHS</a> (<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> q)
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064   <span class="comment">//return &amp;intf[const_cast&lt;Face*&gt;(q)];</span>
<a name="l00065"></a>00065   <a class="code" href="meshmorph_8h.html#4f56986f284adb196d6de25b9f62cee8">htff_it</a> i = intf.find(const_cast&lt;Face*&gt;(q));
<a name="l00066"></a>00066   <span class="keywordflow">if</span> (i==intf.end())
<a name="l00067"></a>00067   {
<a name="l00068"></a>00068     cout &lt;&lt; <span class="stringliteral">"Intersecting_Faces::getIntersectingFacesRHS: Error"</span>
<a name="l00069"></a>00069           &lt;&lt; <span class="stringliteral">"Face was not intersected LHS.\n"</span>;
<a name="l00070"></a>00070     exit(0);
<a name="l00071"></a>00071   }
<a name="l00072"></a>00072   <span class="keywordflow">else</span>
<a name="l00073"></a>00073   {
<a name="l00074"></a>00074     <span class="keywordflow">return</span> &amp;((*i).second);
<a name="l00075"></a>00075   }
<a name="l00076"></a>00076 }
<a name="l00077"></a>00077 
<a name="l00078"></a><a class="code" href="classIntersecting__Faces.html#a1a58bcebe21681324ab18ac410383b2">00078</a> <span class="keywordtype">int</span> <a class="code" href="classIntersecting__Faces.html#a1a58bcebe21681324ab18ac410383b2">Intersecting_Faces::getCountOfIntFaces</a> (<span class="keywordtype">bool</span> detect_self)
<a name="l00079"></a>00079 {
<a name="l00080"></a>00080   <span class="comment">// if detect_self == true, then only count intersections between</span>
<a name="l00081"></a>00081   <span class="comment">//                        faces of same object</span>
<a name="l00082"></a>00082   <span class="comment">// if detect_self == false, then count all intersecting face pairs</span>
<a name="l00083"></a>00083   <span class="keywordtype">int</span> count = 0;
<a name="l00084"></a>00084   <span class="comment">// for each element of hash_map</span>
<a name="l00085"></a>00085   <span class="keywordflow">for</span> (<a class="code" href="meshmorph_8h.html#4f56986f284adb196d6de25b9f62cee8">htff_it</a> i = intf.begin();i!=intf.end();i++)
<a name="l00086"></a>00086   {
<a name="l00087"></a>00087     <span class="comment">// if this face has intersecting faces</span>
<a name="l00088"></a>00088     assert((*i).second.empty()==<span class="keyword">false</span>);
<a name="l00089"></a>00089     <span class="comment">// for each intersecting face</span>
<a name="l00090"></a>00090     <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#c65901c49115edae93d689df5a5e2078">fp_it</a> j=(*i).second.begin();j!=(*i).second.end();j++)
<a name="l00091"></a>00091     {
<a name="l00092"></a>00092       <span class="comment">// assert that intersecting face pair (lhs,rhs) and (rhs,lhs) are in map</span>
<a name="l00093"></a>00093       assert(<a class="code" href="classIntersecting__Faces.html#15292db49cd0b52443bbf9f453e0a84d">faceIsIntersectedLHS</a>(*j)==<span class="keyword">true</span>);
<a name="l00094"></a>00094       assert(<a class="code" href="classIntersecting__Faces.html#40b7910a771bb321d66967a738f5501a">faceIntersectsFace</a>(*j,(*i).first)==<span class="keyword">true</span>);
<a name="l00095"></a>00095       <span class="keywordflow">if</span> (detect_self==<span class="keyword">true</span>)
<a name="l00096"></a>00096       {
<a name="l00097"></a>00097         <span class="keywordflow">if</span> ((*i).first-&gt;getVertex(0)-&gt;getObject()-&gt;getName() == (*j)-&gt;getVertex(0)-&gt;getObject()-&gt;getName())
<a name="l00098"></a>00098         {
<a name="l00099"></a>00099           count++;
<a name="l00100"></a>00100         }
<a name="l00101"></a>00101       }
<a name="l00102"></a>00102       <span class="keywordflow">else</span>
<a name="l00103"></a>00103       {
<a name="l00104"></a>00104         count++;
<a name="l00105"></a>00105       }
<a name="l00106"></a>00106     }
<a name="l00107"></a>00107   }
<a name="l00108"></a>00108   assert((count%2) == 0);
<a name="l00109"></a>00109   <span class="keywordflow">return</span> count/2;
<a name="l00110"></a>00110 }
<a name="l00111"></a>00111 
<a name="l00112"></a><a class="code" href="classIntersecting__Faces.html#40b7910a771bb321d66967a738f5501a">00112</a> <span class="keywordtype">bool</span> <a class="code" href="classIntersecting__Faces.html#40b7910a771bb321d66967a738f5501a">Intersecting_Faces::faceIntersectsFace</a> (<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> haystack,<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> needle)
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114   <span class="comment">// get this face's intersecting faces vector</span>
<a name="l00115"></a>00115   <a class="code" href="meshmorph_8h.html#1f34905de522641c355a51fe9e3f1149">vec_fp</a> <span class="keyword">const</span> * ifv=<a class="code" href="classIntersecting__Faces.html#293abeb5536fd3d69c82f44775d28396">getIntersectingFacesRHS</a>(haystack);
<a name="l00116"></a>00116   <span class="comment">// look for face needle in face haystack's intersecting faces vector</span>
<a name="l00117"></a>00117   <a class="code" href="meshmorph_8h.html#8d2bcc70fbd9a2cca7eecb128703e8c7">fp_cit</a> i=find((*ifv).begin(),(*ifv).end(),needle);
<a name="l00118"></a>00118   <span class="comment">// return true if found</span>
<a name="l00119"></a>00119   <span class="comment">// return false if no found</span>
<a name="l00120"></a>00120   <span class="keywordflow">return</span> (i!=(*ifv).end());
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a><a class="code" href="classIntersecting__Faces.html#15292db49cd0b52443bbf9f453e0a84d">00123</a> <span class="keywordtype">bool</span> <a class="code" href="classIntersecting__Faces.html#15292db49cd0b52443bbf9f453e0a84d">Intersecting_Faces::faceIsIntersectedLHS</a> (<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> i)<span class="keyword"> const</span>
<a name="l00124"></a>00124 <span class="keyword"></span>{
<a name="l00125"></a>00125   <span class="keywordflow">return</span> intf.find(const_cast&lt;Face*&gt;(i))!=intf.end();
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00128"></a><a class="code" href="classIntersecting__Faces.html#533016761a360de5de059ce179acd1a1">00128</a> <span class="keywordtype">bool</span> <a class="code" href="classIntersecting__Faces.html#533016761a360de5de059ce179acd1a1">Intersecting_Faces::faceIsIntersectedRHS</a> (<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> f)<span class="keyword"> const</span>
<a name="l00129"></a>00129 <span class="keyword"></span>{
<a name="l00130"></a>00130   <span class="comment">//return intf[const_cast&lt;Face*&gt;(f)].empty()==false;</span>
<a name="l00131"></a>00131   <a class="code" href="meshmorph_8h.html#d54c98d3b6edd701bc42d29ceb0aca87">htff_cit</a> i = intf.find(const_cast&lt;Face*&gt;(f));
<a name="l00132"></a>00132   <span class="keywordflow">if</span> (i==intf.end())
<a name="l00133"></a>00133   {
<a name="l00134"></a>00134     cout &lt;&lt; <span class="stringliteral">"Intersecting_Faces::faceIsIntersectedRHS: Error"</span>
<a name="l00135"></a>00135           &lt;&lt; <span class="stringliteral">"Face was not intersected LHS.\n"</span>;
<a name="l00136"></a>00136     exit(0);
<a name="l00137"></a>00137   }
<a name="l00138"></a>00138   <span class="keywordflow">else</span>
<a name="l00139"></a>00139   {
<a name="l00140"></a>00140     <span class="keywordflow">return</span> ((*i).second).empty()==<span class="keyword">false</span>;
<a name="l00141"></a>00141   }
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a><a class="code" href="classIntersecting__Faces.html#c53b4894574203b27f4cb6f89ef055d6">00144</a> <span class="keywordtype">bool</span> <a class="code" href="classIntersecting__Faces.html#c53b4894574203b27f4cb6f89ef055d6">Intersecting_Faces::searchForNewFaceInts</a> (<a class="code" href="classFace.html">Face</a> * <span class="keyword">const</span> f,<span class="keywordtype">bool</span> flag)
<a name="l00145"></a>00145 {
<a name="l00146"></a>00146   <span class="comment">// get boxes that overlap with this face's bounding box</span>
<a name="l00147"></a>00147   <a class="code" href="meshmorph_8h.html#58cf62c0a16eae244b83de08e6cb1ad7">vec_bp</a> bp;
<a name="l00148"></a>00148   <a class="code" href="classSpace.html#c0c2e1be07b8a675445b46f575d22a87">Space::instance</a>().<a class="code" href="classSpace.html#dfc42f0706f2d44d88f322d78488ca08">getBoxesToCheck</a>(f,bp);
<a name="l00149"></a>00149   <span class="comment">// for each box in which face lies, add faces in box to vector</span>
<a name="l00150"></a>00150   <a class="code" href="meshmorph_8h.html#1f34905de522641c355a51fe9e3f1149">vec_fp</a> of;
<a name="l00151"></a>00151   of.reserve(<a class="code" href="controls_8h.html#526dd339829f063fe1f5b9219792e7be">VECTOR_RESERVE</a>);
<a name="l00152"></a>00152   <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#dbed886c1b2567fd85a7cbfd42af88e3">bp_it</a> i=bp.begin();i!=bp.end();i++)
<a name="l00153"></a>00153   {
<a name="l00154"></a>00154     <span class="keywordflow">if</span>(flag==<span class="keyword">true</span>)
<a name="l00155"></a>00155     {
<a name="l00156"></a>00156       <span class="comment">// add box*s to multimap nb</span>
<a name="l00157"></a>00157       <span class="comment">//nb-&gt;insert(std::make_pair(f,*i));</span>
<a name="l00158"></a>00158       <a class="code" href="classState.html#cd3aa3488c0124d7d4774ff0f7250685">State::instance</a>().<a class="code" href="classState.html#73fe266dcbb27bc9cac8cec4ab060ea8">addNewFace</a>(f,*i);
<a name="l00159"></a>00159     }
<a name="l00160"></a>00160     <span class="comment">// collect all unique faces in chosen boxes</span>
<a name="l00161"></a>00161     of.insert(of.end(),(*i)-&gt;begin(),(*i)-&gt;end());
<a name="l00162"></a>00162   }
<a name="l00163"></a>00163   <span class="comment">// sort and keep unique faces</span>
<a name="l00164"></a>00164   sort(of.begin(),of.end());
<a name="l00165"></a>00165   of.assign(of.begin(),unique(of.begin(),of.end()));
<a name="l00166"></a>00166   <span class="comment">// for each unique face</span>
<a name="l00167"></a>00167   <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#c65901c49115edae93d689df5a5e2078">fp_it</a> i=of.begin();i!=of.end();i++)
<a name="l00168"></a>00168   {
<a name="l00169"></a>00169     <span class="comment">// if unique face is not same as current face</span>
<a name="l00170"></a>00170     <span class="keywordflow">if</span>(*i!=f)
<a name="l00171"></a>00171     {
<a name="l00172"></a>00172       <span class="comment">// if faces intersect</span>
<a name="l00173"></a>00173       <span class="keywordflow">if</span> (<a class="code" href="classIntersecting__Faces.html#f15a18276918e03d465d56b9b25af3b1">checkFaceFaceInts</a>(f,*i))
<a name="l00174"></a>00174       { 
<a name="l00175"></a>00175         <span class="keywordflow">if</span>(<a class="code" href="controls_8h.html#0e7219c0ea3b109ee655aebc8fa4c8bd">STRICT_FACE_INTERSECTION_PREVENTION</a>==<span class="keyword">true</span>)
<a name="l00176"></a>00176         {
<a name="l00177"></a>00177           <span class="comment">// if this face previously had no intersections, then reject move</span>
<a name="l00178"></a>00178           <span class="keywordflow">if</span>(<a class="code" href="classIntersecting__Faces.html#15292db49cd0b52443bbf9f453e0a84d">faceIsIntersectedLHS</a>(f)==<span class="keyword">false</span>){<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00179"></a>00179           <span class="comment">// else face was previously intersected</span>
<a name="l00180"></a>00180           <span class="keywordflow">else</span>
<a name="l00181"></a>00181           {
<a name="l00182"></a>00182             <span class="comment">// grab previous intersecting faces of this face</span>
<a name="l00183"></a>00183             <a class="code" href="meshmorph_8h.html#1f34905de522641c355a51fe9e3f1149">vec_fp</a> *fv=<a class="code" href="classIntersecting__Faces.html#293abeb5536fd3d69c82f44775d28396">getIntersectingFacesRHS</a>(f);
<a name="l00184"></a>00184             <span class="keywordtype">bool</span> same=<span class="keyword">false</span>;
<a name="l00185"></a>00185             <span class="comment">// for each previous intersecting face</span>
<a name="l00186"></a>00186             <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#c65901c49115edae93d689df5a5e2078">fp_it</a> p=(*fv).begin();p!=(*fv).end();p++)
<a name="l00187"></a>00187             {
<a name="l00188"></a>00188               <span class="comment">// if current intersecting face is of same object</span>
<a name="l00189"></a>00189               <span class="comment">//  as previous intersecting face</span>
<a name="l00190"></a>00190               <span class="keywordflow">if</span>((*p)-&gt;getVertex(0)-&gt;getObject()==(*i)-&gt;getVertex(0)-&gt;getObject()){same=<span class="keyword">true</span>;}
<a name="l00191"></a>00191             }
<a name="l00192"></a>00192             <span class="comment">// if intersecting objects have changed from before to now</span>
<a name="l00193"></a>00193             <span class="comment">// then reject move</span>
<a name="l00194"></a>00194             <span class="keywordflow">if</span>(!same){<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00195"></a>00195           }
<a name="l00196"></a>00196         }
<a name="l00197"></a>00197         <span class="keywordflow">else</span>
<a name="l00198"></a>00198         {
<a name="l00199"></a>00199           <span class="comment">// if current face if of same object as intersecting face, then reject move</span>
<a name="l00200"></a>00200           <span class="keywordflow">if</span>(f-&gt;getVertex(0)-&gt;getObject()==(*i)-&gt;getVertex(0)-&gt;getObject()){<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00201"></a>00201         }
<a name="l00202"></a>00202       }
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204   }
<a name="l00205"></a>00205   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00206"></a>00206 }
<a name="l00207"></a>00207 
<a name="l00214"></a><a class="code" href="classIntersecting__Faces.html#c1bb38e2d09c62762bfa566bdb21bdf5">00214</a> <span class="keywordtype">bool</span> <a class="code" href="classIntersecting__Faces.html#c1bb38e2d09c62762bfa566bdb21bdf5">Intersecting_Faces::findAndRecordNewFaceInt</a> (<a class="code" href="classFace.html">Face</a> * <span class="keyword">const</span> f)
<a name="l00215"></a>00215 {
<a name="l00216"></a>00216   <span class="keywordtype">bool</span> flag = <span class="keyword">false</span>;
<a name="l00217"></a>00217   <span class="comment">// get boxes that overlap this face's bounding box</span>
<a name="l00218"></a>00218   <a class="code" href="meshmorph_8h.html#58cf62c0a16eae244b83de08e6cb1ad7">vec_bp</a> bp;
<a name="l00219"></a>00219   <a class="code" href="classSpace.html#c0c2e1be07b8a675445b46f575d22a87">Space::instance</a>().<a class="code" href="classSpace.html#dfc42f0706f2d44d88f322d78488ca08">getBoxesToCheck</a>(f,bp);
<a name="l00220"></a>00220   <span class="comment">// for each box in which face lies, add faces in box to vector</span>
<a name="l00221"></a>00221   <a class="code" href="meshmorph_8h.html#1f34905de522641c355a51fe9e3f1149">vec_fp</a> of;
<a name="l00222"></a>00222   of.reserve(<a class="code" href="controls_8h.html#526dd339829f063fe1f5b9219792e7be">VECTOR_RESERVE</a>);
<a name="l00223"></a>00223   <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#dbed886c1b2567fd85a7cbfd42af88e3">bp_it</a> i=bp.begin();i!=bp.end();i++)
<a name="l00224"></a>00224   {
<a name="l00225"></a>00225     <span class="comment">// collect all unique faces in chosen boxes</span>
<a name="l00226"></a>00226     of.insert(of.end(),(*i)-&gt;begin(),(*i)-&gt;end());
<a name="l00227"></a>00227   }
<a name="l00228"></a>00228   <span class="comment">// sort and keep unique faces</span>
<a name="l00229"></a>00229   sort(of.begin(),of.end());
<a name="l00230"></a>00230   of.assign(of.begin(),unique(of.begin(),of.end()));
<a name="l00231"></a>00231   <span class="comment">// for each unique face</span>
<a name="l00232"></a>00232   <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#c65901c49115edae93d689df5a5e2078">fp_it</a> i=of.begin();i!=of.end();i++)
<a name="l00233"></a>00233   {
<a name="l00234"></a>00234     <span class="comment">// if unique face is not same as current face</span>
<a name="l00235"></a>00235     <span class="keywordflow">if</span>(*i!=f)
<a name="l00236"></a>00236     {
<a name="l00237"></a>00237       <span class="comment">// if faces intersect</span>
<a name="l00238"></a>00238       <span class="keywordflow">if</span> (<a class="code" href="classIntersecting__Faces.html#f15a18276918e03d465d56b9b25af3b1">checkFaceFaceInts</a>(f,*i))
<a name="l00239"></a>00239       {
<a name="l00240"></a>00240         <span class="comment">// save intersecting face* to this face's intersecting face vector</span>
<a name="l00241"></a>00241         <a class="code" href="classIntersecting__Faces.html#412a607e81b48c4d51a6947cb32b2569">addFaceToFace</a>(f,*i);
<a name="l00242"></a>00242         <span class="comment">// return</span>
<a name="l00243"></a>00243         flag = <span class="keyword">true</span>;
<a name="l00244"></a>00244       }
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246   }
<a name="l00247"></a>00247   <span class="keywordflow">return</span> flag;
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00256"></a><a class="code" href="classIntersecting__Faces.html#d0b9954e791421bbdbcdc0aa6bc13a88">00256</a> <span class="keywordtype">bool</span> <a class="code" href="classIntersecting__Faces.html#d0b9954e791421bbdbcdc0aa6bc13a88">Intersecting_Faces::vertAdjFacesHaveNewInt</a> (<a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span> * <span class="keyword">const</span> v)
<a name="l00257"></a>00257 {
<a name="l00258"></a>00258   <span class="comment">// for each adjacent face of current vertex</span>
<a name="l00259"></a>00259   <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#8d2bcc70fbd9a2cca7eecb128703e8c7">fp_cit</a> i=v-&gt;<a class="code" href="classVertex.html#7ebc259c68c71408ecc67662d64e9ec0">begin</a>();i!=v-&gt;<a class="code" href="classVertex.html#4bb81e4284f35a668f19495419a23abb">end</a>();i++)
<a name="l00260"></a>00260   {
<a name="l00261"></a>00261     <span class="comment">//  if face intersects any other face, then return true</span>
<a name="l00262"></a>00262     <span class="keywordflow">if</span>(<a class="code" href="classIntersecting__Faces.html#c53b4894574203b27f4cb6f89ef055d6">searchForNewFaceInts</a>(*i,<span class="keyword">true</span>)==<span class="keyword">true</span>){<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00263"></a>00263   }
<a name="l00264"></a>00264   <span class="comment">// no adjacent faces of current vertex intersect any other face</span>
<a name="l00265"></a>00265   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267 
<a name="l00275"></a><a class="code" href="classIntersecting__Faces.html#412a607e81b48c4d51a6947cb32b2569">00275</a> <span class="keywordtype">void</span> <a class="code" href="classIntersecting__Faces.html#412a607e81b48c4d51a6947cb32b2569">Intersecting_Faces::addFaceToFace</a> (<a class="code" href="classFace.html">Face</a> * <span class="keyword">const</span> lhs,<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> rhs)
<a name="l00276"></a>00276 {
<a name="l00277"></a>00277   <span class="comment">// if this face not in intf</span>
<a name="l00278"></a>00278   <span class="keywordflow">if</span>(<a class="code" href="classIntersecting__Faces.html#15292db49cd0b52443bbf9f453e0a84d">faceIsIntersectedLHS</a>(lhs)==<span class="keyword">false</span>)
<a name="l00279"></a>00279   {
<a name="l00280"></a>00280     <span class="comment">// create new face vector in table</span>
<a name="l00281"></a>00281     <a class="code" href="meshmorph_8h.html#1f34905de522641c355a51fe9e3f1149">vec_fp</a> nv;
<a name="l00282"></a>00282     intf[lhs]=nv;
<a name="l00283"></a>00283   }
<a name="l00284"></a>00284   <span class="comment">// face f not already in vector</span>
<a name="l00285"></a>00285   <span class="keywordflow">if</span>(<a class="code" href="classIntersecting__Faces.html#40b7910a771bb321d66967a738f5501a">faceIntersectsFace</a>(lhs,rhs)==<span class="keyword">false</span>)
<a name="l00286"></a>00286   {
<a name="l00287"></a>00287     <span class="comment">// add face f to this face's intersecting faces vector</span>
<a name="l00288"></a>00288     intf[lhs].push_back(const_cast&lt;Face*&gt;(rhs));
<a name="l00289"></a>00289   }
<a name="l00290"></a>00290 }
<a name="l00291"></a>00291 
<a name="l00298"></a><a class="code" href="classIntersecting__Faces.html#308378379127c964fb70a1dad0fae0de">00298</a> <span class="keywordtype">void</span> <a class="code" href="classIntersecting__Faces.html#308378379127c964fb70a1dad0fae0de">Intersecting_Faces::setFaceNotIntersectedLHS</a> (<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> f)
<a name="l00299"></a>00299 {
<a name="l00300"></a>00300   <span class="comment">// if this face is in intf table </span>
<a name="l00301"></a>00301   <span class="keywordflow">if</span>(<a class="code" href="classIntersecting__Faces.html#15292db49cd0b52443bbf9f453e0a84d">faceIsIntersectedLHS</a>(f)==<span class="keyword">true</span>)
<a name="l00302"></a>00302   {
<a name="l00303"></a>00303     <span class="comment">// get this face's intersecting faces vector</span>
<a name="l00304"></a>00304     <a class="code" href="meshmorph_8h.html#1f34905de522641c355a51fe9e3f1149">vec_fp</a> *ifv=<a class="code" href="classIntersecting__Faces.html#293abeb5536fd3d69c82f44775d28396">getIntersectingFacesRHS</a>(f);
<a name="l00305"></a>00305     <span class="comment">// if intersecting faces vector is not empty</span>
<a name="l00306"></a>00306     <span class="keywordflow">if</span>((*ifv).empty()==<span class="keyword">false</span>)
<a name="l00307"></a>00307     {
<a name="l00308"></a>00308       <span class="comment">// for each face in intersection vector</span>
<a name="l00309"></a>00309       <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#c65901c49115edae93d689df5a5e2078">fp_it</a> i=(*ifv).begin();i!=(*ifv).end();i++)
<a name="l00310"></a>00310       {
<a name="l00311"></a>00311         <span class="comment">// remove this face from intersection vector of that face</span>
<a name="l00312"></a>00312         <a class="code" href="classIntersecting__Faces.html#2ba705827cb13702fe3c88836220561a">removeFaceFromFaceInt</a>(*i,f);
<a name="l00313"></a>00313       }
<a name="l00314"></a>00314       (*ifv).clear();
<a name="l00315"></a>00315     }
<a name="l00316"></a>00316     <span class="comment">// remove element from table</span>
<a name="l00317"></a>00317     intf.erase(const_cast&lt;Face*&gt;(f));
<a name="l00318"></a>00318   }
<a name="l00319"></a>00319 }
<a name="l00320"></a>00320 
<a name="l00328"></a><a class="code" href="classIntersecting__Faces.html#2ba705827cb13702fe3c88836220561a">00328</a> <span class="keywordtype">void</span> <a class="code" href="classIntersecting__Faces.html#2ba705827cb13702fe3c88836220561a">Intersecting_Faces::removeFaceFromFaceInt</a> (<a class="code" href="classFace.html">Face</a> * <span class="keyword">const</span> lhs,<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> rhs)
<a name="l00329"></a>00329 {
<a name="l00330"></a>00330   <span class="comment">// if this face has intersecting faces in hashmap intf</span>
<a name="l00331"></a>00331   <span class="keywordflow">if</span>(<a class="code" href="classIntersecting__Faces.html#15292db49cd0b52443bbf9f453e0a84d">faceIsIntersectedLHS</a>(lhs)==<span class="keyword">true</span>)
<a name="l00332"></a>00332   {
<a name="l00333"></a>00333     <span class="comment">// get this face's intersecting faces vector</span>
<a name="l00334"></a>00334     <a class="code" href="meshmorph_8h.html#1f34905de522641c355a51fe9e3f1149">vec_fp</a> *ifv=<a class="code" href="classIntersecting__Faces.html#293abeb5536fd3d69c82f44775d28396">getIntersectingFacesRHS</a>(lhs);
<a name="l00335"></a>00335     <span class="comment">// look for face rhs in face lhs's intersecting faces vector</span>
<a name="l00336"></a>00336     <a class="code" href="meshmorph_8h.html#c65901c49115edae93d689df5a5e2078">fp_it</a> i=find((*ifv).begin(),(*ifv).end(),rhs);
<a name="l00337"></a>00337     <span class="comment">// if found</span>
<a name="l00338"></a>00338     <span class="keywordflow">if</span> (i!=(*ifv).end())
<a name="l00339"></a>00339     {
<a name="l00340"></a>00340       <span class="comment">// remove face f from this face's intersecting faces vector</span>
<a name="l00341"></a>00341       (*ifv).erase(remove((*ifv).begin(),(*ifv).end(),rhs),(*ifv).end());
<a name="l00342"></a>00342       <span class="comment">// if intersecting face vector is now empty</span>
<a name="l00343"></a>00343       <span class="keywordflow">if</span> (<a class="code" href="classIntersecting__Faces.html#533016761a360de5de059ce179acd1a1">faceIsIntersectedRHS</a>(lhs)==<span class="keyword">false</span>)
<a name="l00344"></a>00344       {
<a name="l00345"></a>00345         <span class="comment">// then remove intersecting face vector from hashtable</span>
<a name="l00346"></a>00346         <a class="code" href="classIntersecting__Faces.html#308378379127c964fb70a1dad0fae0de">setFaceNotIntersectedLHS</a>(lhs);
<a name="l00347"></a>00347       }
<a name="l00348"></a>00348     }
<a name="l00349"></a>00349   }
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 
<a name="l00361"></a><a class="code" href="classIntersecting__Faces.html#5605b62ecf28cc1f44518b7e6acbb4f8">00361</a> <span class="keywordtype">void</span> <a class="code" href="classIntersecting__Faces.html#5605b62ecf28cc1f44518b7e6acbb4f8">Intersecting_Faces::removeOldIntersections</a> (<a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span> * <span class="keyword">const</span> v,<a class="code" href="meshmorph_8h.html#274b35739790732fd62f8771c082edb0">hashset_v</a> &amp; ni)
<a name="l00362"></a>00362 {
<a name="l00363"></a>00363   <span class="comment">// collect the vertices of all intersecting faces</span>
<a name="l00364"></a>00364   <span class="comment">// of all adjacent faces to current vertex</span>
<a name="l00365"></a>00365   <span class="comment">// into vset, i.e. hash_set of Vertex*s.</span>
<a name="l00366"></a>00366   <span class="comment">//</span>
<a name="l00367"></a>00367   <span class="comment">// for every adjacent face</span>
<a name="l00368"></a>00368   <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#8d2bcc70fbd9a2cca7eecb128703e8c7">fp_cit</a> k=v-&gt;<a class="code" href="classVertex.html#7ebc259c68c71408ecc67662d64e9ec0">begin</a>();k!=v-&gt;<a class="code" href="classVertex.html#4bb81e4284f35a668f19495419a23abb">end</a>();k++)
<a name="l00369"></a>00369   {
<a name="l00370"></a>00370     <span class="comment">// if adjacent face has intersecting faces</span>
<a name="l00371"></a>00371     <span class="keywordflow">if</span>(<a class="code" href="classIntersecting__Faces.html#15292db49cd0b52443bbf9f453e0a84d">faceIsIntersectedLHS</a>(*k)==<span class="keyword">true</span>)
<a name="l00372"></a>00372     {
<a name="l00373"></a>00373       <span class="comment">// for each intersecting face of adjacent face</span>
<a name="l00374"></a>00374       <a class="code" href="meshmorph_8h.html#1f34905de522641c355a51fe9e3f1149">vec_fp</a> *fv=<a class="code" href="classIntersecting__Faces.html#293abeb5536fd3d69c82f44775d28396">getIntersectingFacesRHS</a>(*k);
<a name="l00375"></a>00375       <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#c65901c49115edae93d689df5a5e2078">fp_it</a> p=(*fv).begin();p!=(*fv).end();p++)
<a name="l00376"></a>00376       {
<a name="l00377"></a>00377         <span class="comment">// add intersecting face vertices to vset2</span>
<a name="l00378"></a>00378         ni.insert((*p)-&gt;getVertex(0));
<a name="l00379"></a>00379         ni.insert((*p)-&gt;getVertex(1));
<a name="l00380"></a>00380         ni.insert((*p)-&gt;getVertex(2));
<a name="l00381"></a>00381         <span class="comment">// remove adjacent face from intersecting face's vector</span>
<a name="l00382"></a>00382         <a class="code" href="classIntersecting__Faces.html#2ba705827cb13702fe3c88836220561a">removeFaceFromFaceInt</a>(*p,*k);
<a name="l00383"></a>00383       }
<a name="l00384"></a>00384     }
<a name="l00385"></a>00385     <span class="comment">// clear adjacent face's intersecting face vector</span>
<a name="l00386"></a>00386     <a class="code" href="classIntersecting__Faces.html#308378379127c964fb70a1dad0fae0de">setFaceNotIntersectedLHS</a>(*k);
<a name="l00387"></a>00387   }
<a name="l00388"></a>00388 }
<a name="l00389"></a>00389 
<a name="l00399"></a><a class="code" href="classIntersecting__Faces.html#d0b67f47b2af8f1f131009503cbc8a2a">00399</a> <span class="keywordtype">void</span> <a class="code" href="classIntersecting__Faces.html#d0b67f47b2af8f1f131009503cbc8a2a">Intersecting_Faces::updateNewIntersections</a> (<a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span> * <span class="keyword">const</span> v,<a class="code" href="meshmorph_8h.html#274b35739790732fd62f8771c082edb0">hashset_v</a> &amp; ni)
<a name="l00400"></a>00400 {
<a name="l00401"></a>00401   <span class="comment">// for every adjacent face</span>
<a name="l00402"></a>00402   <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#8d2bcc70fbd9a2cca7eecb128703e8c7">fp_cit</a> k=v-&gt;<a class="code" href="classVertex.html#7ebc259c68c71408ecc67662d64e9ec0">begin</a>();k!=v-&gt;<a class="code" href="classVertex.html#4bb81e4284f35a668f19495419a23abb">end</a>();k++)
<a name="l00403"></a>00403   {
<a name="l00404"></a>00404     <span class="comment">// if adjacent face is currently intersected</span>
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (<a class="code" href="classIntersecting__Faces.html#c53b4894574203b27f4cb6f89ef055d6">searchForNewFaceInts</a>(*k,<span class="keyword">false</span>))
<a name="l00406"></a>00406     {
<a name="l00407"></a>00407       <span class="comment">// for each intersecting face of adjacent face</span>
<a name="l00408"></a>00408       <a class="code" href="meshmorph_8h.html#1f34905de522641c355a51fe9e3f1149">vec_fp</a> *fv=<a class="code" href="classIntersecting__Faces.html#293abeb5536fd3d69c82f44775d28396">getIntersectingFacesRHS</a>(*k);
<a name="l00409"></a>00409       <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#c65901c49115edae93d689df5a5e2078">fp_it</a> p=(*fv).begin();p!=(*fv).end();p++)
<a name="l00410"></a>00410       {
<a name="l00411"></a>00411         <span class="comment">// add intersecting face vertices to vset2</span>
<a name="l00412"></a>00412         ni.insert((*p)-&gt;getVertex(0));
<a name="l00413"></a>00413         ni.insert((*p)-&gt;getVertex(1));
<a name="l00414"></a>00414         ni.insert((*p)-&gt;getVertex(2));
<a name="l00415"></a>00415         <span class="comment">// if intersected face was previously not intersected</span>
<a name="l00416"></a>00416         <span class="keywordflow">if</span>(<a class="code" href="classIntersecting__Faces.html#15292db49cd0b52443bbf9f453e0a84d">faceIsIntersectedLHS</a>(*p)==<span class="keyword">false</span>)
<a name="l00417"></a>00417         {
<a name="l00418"></a>00418           <span class="comment">// create new face vector in table</span>
<a name="l00419"></a>00419           <a class="code" href="meshmorph_8h.html#1f34905de522641c355a51fe9e3f1149">vec_fp</a> nv;
<a name="l00420"></a>00420           intf[*p]=nv;
<a name="l00421"></a>00421         }
<a name="l00422"></a>00422         <span class="comment">// add adjacent face* to intersected face</span>
<a name="l00423"></a>00423         <a class="code" href="classIntersecting__Faces.html#412a607e81b48c4d51a6947cb32b2569">addFaceToFace</a>(*p,*k);
<a name="l00424"></a>00424       }
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426   }
<a name="l00427"></a>00427 }
<a name="l00428"></a>00428 
<a name="l00436"></a><a class="code" href="classIntersecting__Faces.html#540d46017e3f03c2e26052b31e99ded1">00436</a> <a class="code" href="meshmorph_8h.html#274b35739790732fd62f8771c082edb0">hashset_v</a> <a class="code" href="classIntersecting__Faces.html#540d46017e3f03c2e26052b31e99ded1">Intersecting_Faces::getNiceCheckSet</a> (<a class="code" href="classVertex.html">Vertex</a> <span class="keyword">const</span> * <span class="keyword">const</span> v)
<a name="l00437"></a>00437 {
<a name="l00438"></a>00438   <a class="code" href="meshmorph_8h.html#274b35739790732fd62f8771c082edb0">hashset_v</a> ni;
<a name="l00439"></a>00439   <span class="comment">// add current vertex</span>
<a name="l00440"></a>00440   ni.insert(const_cast&lt;Vertex*&gt;(v));
<a name="l00441"></a>00441   <a class="code" href="classIntersecting__Faces.html#5605b62ecf28cc1f44518b7e6acbb4f8">removeOldIntersections</a>(v,ni);
<a name="l00442"></a>00442   <a class="code" href="classIntersecting__Faces.html#d0b67f47b2af8f1f131009503cbc8a2a">updateNewIntersections</a>(v,ni);
<a name="l00443"></a>00443   <span class="keywordflow">return</span> ni;
<a name="l00444"></a>00444 }
<a name="l00445"></a>00445 
<a name="l00454"></a><a class="code" href="classIntersecting__Faces.html#315e085f96a18a8cbb7d1bf788e5e029">00454</a> <span class="keywordtype">void</span> <a class="code" href="classIntersecting__Faces.html#315e085f96a18a8cbb7d1bf788e5e029">Intersecting_Faces::getNiceSet</a> (<a class="code" href="meshmorph_8h.html#a2f71558ba2b448f8c9d69e13a5103be">vec_vp</a> &amp; fs,<a class="code" href="meshmorph_8h.html#274b35739790732fd62f8771c082edb0">hashset_v</a> &amp; ni)
<a name="l00455"></a>00455 {
<a name="l00456"></a>00456   <span class="comment">// for each vertex whose niceness may have changed</span>
<a name="l00457"></a>00457   <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#006012383947c6f228dc7ce628bfc148">hv_it</a> i=ni.begin();i!=ni.end();i++)
<a name="l00458"></a>00458   {
<a name="l00459"></a>00459     <span class="comment">// update niceness</span>
<a name="l00460"></a>00460     <span class="keywordflow">if</span>(<a class="code" href="classNice.html#0e7a8f2b7f6c9e5a41b4f0a106a7614e">Nice::instance</a>().updateVertexNiceness(*i))
<a name="l00461"></a>00461     {
<a name="l00462"></a>00462       <span class="comment">// if niceness changed</span>
<a name="l00463"></a>00463       <span class="comment">// i.e. was nice and now not,</span>
<a name="l00464"></a>00464       <span class="comment">// or was not nice and now is</span>
<a name="l00465"></a>00465       <span class="comment">// then add vertex to set </span>
<a name="l00466"></a>00466       <span class="comment">// requiring full search for closest point</span>
<a name="l00467"></a>00467       fs.push_back(*i);
<a name="l00468"></a>00468       <span class="comment">//State::instance().addVertexToFullSearch(*i);</span>
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470   }
<a name="l00471"></a>00471 }
<a name="l00472"></a>00472 
<a name="l00478"></a><a class="code" href="classIntersecting__Faces.html#864360dc51339359609a9dec82defe06">00478</a> <span class="keywordtype">void</span> <a class="code" href="classIntersecting__Faces.html#864360dc51339359609a9dec82defe06">Intersecting_Faces::findAllFaceIntersections</a> (<span class="keywordtype">void</span>)
<a name="l00479"></a>00479 {
<a name="l00480"></a>00480   cout &lt;&lt; <span class="stringliteral">"Find all face intersections...................."</span>;
<a name="l00481"></a>00481   cout.flush();
<a name="l00482"></a>00482   <span class="keywordtype">int</span> k=1;
<a name="l00483"></a>00483   <span class="keywordtype">double</span> goal = 0.2;
<a name="l00484"></a>00484   cout &lt;&lt; <span class="stringliteral">"0%.."</span>;
<a name="l00485"></a>00485   cout.flush();
<a name="l00486"></a>00486   <span class="comment">// clear table</span>
<a name="l00487"></a>00487   intf.clear();
<a name="l00488"></a>00488   <span class="comment">// for each object</span>
<a name="l00489"></a>00489   <span class="keywordtype">double</span> a = 1.0/<a class="code" href="classContainer.html#e4646d7b418a9b302db245f074ad8ec5">Container::instance</a>().<a class="code" href="classContainer.html#c3ac0ef8e13fb01215064cd9bd24ff85">o</a>.size();
<a name="l00490"></a>00490   <span class="keywordflow">for</span> (<a class="code" href="meshmorph_8h.html#ee98e25193e5b352ac2eefbd05ccde6a">o_it</a> i=<a class="code" href="classContainer.html#e4646d7b418a9b302db245f074ad8ec5">Container::instance</a>().o.begin();i!=<a class="code" href="classContainer.html#e4646d7b418a9b302db245f074ad8ec5">Container::instance</a>().<a class="code" href="classContainer.html#c3ac0ef8e13fb01215064cd9bd24ff85">o</a>.end();i++)
<a name="l00491"></a>00491   {
<a name="l00492"></a>00492     <span class="comment">// for each face in object</span>
<a name="l00493"></a>00493     <span class="keywordflow">for</span> (<a class="code" href="meshmorph_8h.html#a19fd10324725dd9216be23ee875011e">f_it</a> j=i-&gt;f.begin();j!=i-&gt;f.end();j++)
<a name="l00494"></a>00494     {
<a name="l00495"></a>00495       <a class="code" href="classIntersecting__Faces.html#c1bb38e2d09c62762bfa566bdb21bdf5">findAndRecordNewFaceInt</a>(&amp;(*j));
<a name="l00496"></a>00496     }
<a name="l00497"></a>00497     <span class="comment">// track progress</span>
<a name="l00498"></a>00498     <span class="keywordtype">double</span> progress = static_cast&lt;double&gt;(k++)*a;
<a name="l00499"></a>00499     <span class="keywordflow">if</span>(progress&gt;goal)
<a name="l00500"></a>00500     {
<a name="l00501"></a>00501       cout &lt;&lt; static_cast&lt;int&gt;(goal*100) &lt;&lt; <span class="stringliteral">"%.."</span>;
<a name="l00502"></a>00502       cout.flush();
<a name="l00503"></a>00503       goal+=0.2;
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505   }
<a name="l00506"></a>00506   cout &lt;&lt; <span class="stringliteral">"100%..complete.\n"</span>;
<a name="l00507"></a>00507   cout.flush();
<a name="l00508"></a>00508 }
<a name="l00509"></a>00509 
<a name="l00517"></a><a class="code" href="classIntersecting__Faces.html#3def09e209230ee7192742008c9dde0c">00517</a> <span class="keywordtype">void</span> <a class="code" href="classIntersecting__Faces.html#3def09e209230ee7192742008c9dde0c">Intersecting_Faces::getFaceIntersectionForce</a> (<a class="code" href="classFace.html">Face</a> * <span class="keyword">const</span> f,<span class="keywordtype">double</span> * <span class="keyword">const</span> &amp; total_force)
<a name="l00518"></a>00518 {
<a name="l00519"></a>00519   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> d(3,0);
<a name="l00520"></a>00520   <span class="comment">// if this face has intersecting faces</span>
<a name="l00521"></a>00521   assert(<a class="code" href="classIntersecting__Faces.html#15292db49cd0b52443bbf9f453e0a84d">faceIsIntersectedLHS</a>(f)==<span class="keyword">true</span> &amp;&amp; <a class="code" href="classIntersecting__Faces.html#533016761a360de5de059ce179acd1a1">faceIsIntersectedRHS</a>(f)==<span class="keyword">true</span> );
<a name="l00522"></a>00522   <span class="comment">// get intersecting faces</span>
<a name="l00523"></a>00523   <a class="code" href="meshmorph_8h.html#1f34905de522641c355a51fe9e3f1149">vec_fp</a>* ptr = <a class="code" href="classIntersecting__Faces.html#293abeb5536fd3d69c82f44775d28396">getIntersectingFacesRHS</a>(f);
<a name="l00524"></a>00524   <span class="comment">// for each intersecting face</span>
<a name="l00525"></a>00525   <span class="keywordflow">for</span>(<a class="code" href="meshmorph_8h.html#c65901c49115edae93d689df5a5e2078">fp_it</a> i=ptr-&gt;begin();i!=ptr-&gt;end();i++)
<a name="l00526"></a>00526   {
<a name="l00527"></a>00527     <a class="code" href="classIntersecting__Faces.html#486234fb9b4e9ecd76e1ad1fc5d2dc9c">getFaceFaceIntForce</a>(f,*i,d);
<a name="l00528"></a>00528   }
<a name="l00529"></a>00529   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;3;i++) {total_force[0]+=d[0];}
<a name="l00530"></a>00530 }
<a name="l00531"></a>00531 
<a name="l00540"></a><a class="code" href="classIntersecting__Faces.html#486234fb9b4e9ecd76e1ad1fc5d2dc9c">00540</a> <span class="keywordtype">void</span> <a class="code" href="classIntersecting__Faces.html#486234fb9b4e9ecd76e1ad1fc5d2dc9c">Intersecting_Faces::getFaceFaceIntForce</a> (<a class="code" href="classFace.html">Face</a> * <span class="keyword">const</span> lhs,
<a name="l00541"></a>00541                                               <a class="code" href="classFace.html">Face</a> * <span class="keyword">const</span> rhs,
<a name="l00542"></a>00542                                               <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> &amp; total_force)
<a name="l00543"></a>00543 {
<a name="l00544"></a>00544   assert(<a class="code" href="classIntersecting__Faces.html#40b7910a771bb321d66967a738f5501a">faceIntersectsFace</a>(lhs,rhs) &amp;&amp; <a class="code" href="classIntersecting__Faces.html#40b7910a771bb321d66967a738f5501a">faceIntersectsFace</a>(rhs,lhs));
<a name="l00545"></a>00545   <span class="comment">// get current face normal</span>
<a name="l00546"></a>00546   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> n1 = lhs-&gt;<a class="code" href="classFace.html#c562850fda0a0725a6aebbc80ababa20">getNormal</a>();
<a name="l00547"></a>00547   <span class="keywordtype">double</span> m1=1.0/sqrt(n1[0]*n1[0]+n1[1]*n1[1]+n1[2]*n1[2]);
<a name="l00548"></a>00548   n1[0]=n1[0]*m1;
<a name="l00549"></a>00549   n1[1]=n1[1]*m1;
<a name="l00550"></a>00550   n1[2]=n1[2]*m1;
<a name="l00551"></a>00551   <span class="comment">// get intersecting face normal</span>
<a name="l00552"></a>00552   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> n2 = rhs-&gt;<a class="code" href="classFace.html#c562850fda0a0725a6aebbc80ababa20">getNormal</a>();
<a name="l00553"></a>00553   <span class="keywordtype">double</span> m2=1.0/sqrt(n2[0]*n2[0]+n2[1]*n2[1]+n2[2]*n2[2]);
<a name="l00554"></a>00554   n2[0]=n2[0]*m2;
<a name="l00555"></a>00555   n2[1]=n2[1]*m2;
<a name="l00556"></a>00556   n2[2]=n2[2]*m2;
<a name="l00557"></a>00557   <span class="comment">// compute resultant vector</span>
<a name="l00558"></a>00558   <span class="keywordtype">double</span> R[3];
<a name="l00559"></a>00559   R[0]=n1[0]+n2[0];
<a name="l00560"></a>00560   R[1]=n1[1]+n2[1];
<a name="l00561"></a>00561   R[2]=n1[2]+n2[2];
<a name="l00562"></a>00562   <span class="comment">// compute cross product, T, as N1 X N2</span>
<a name="l00563"></a>00563   <span class="keywordtype">double</span> T[3];
<a name="l00564"></a>00564   T[0] = n1[1]*n2[2]-n1[2]*n2[1];
<a name="l00565"></a>00565   T[1] = n1[2]*n2[0]-n1[0]*n2[2];
<a name="l00566"></a>00566   T[2] = n1[0]*n2[1]-n1[1]*n2[0];
<a name="l00567"></a>00567   <span class="comment">// compute cross product, P, as T X R</span>
<a name="l00568"></a>00568   <span class="keywordtype">double</span> P[3];
<a name="l00569"></a>00569   P[0] = T[1]*R[2]-T[2]*R[1];
<a name="l00570"></a>00570   P[1] = T[2]*R[0]-T[0]*R[2];
<a name="l00571"></a>00571   P[2] = T[0]*R[1]-T[1]*R[0];
<a name="l00572"></a>00572   <span class="comment">// P length</span>
<a name="l00573"></a>00573   <span class="keywordtype">double</span> den = <a class="code" href="controls_8h.html#998fb5a621f6ed21c22b9a2905b5264c">INTERSECTION_WEIGHT</a>/sqrt(P[0]*P[0]+P[1]*P[1]+P[2]*P[2]);
<a name="l00574"></a>00574   <span class="comment">// compute force</span>
<a name="l00575"></a>00575   total_force[0]+=P[0]*den;
<a name="l00576"></a>00576   total_force[1]+=P[1]*den;
<a name="l00577"></a>00577   total_force[2]+=P[2]*den;
<a name="l00578"></a>00578 }
<a name="l00579"></a>00579 
<a name="l00587"></a><a class="code" href="classIntersecting__Faces.html#f15a18276918e03d465d56b9b25af3b1">00587</a> <span class="keywordtype">bool</span> <a class="code" href="classIntersecting__Faces.html#f15a18276918e03d465d56b9b25af3b1">Intersecting_Faces::checkFaceFaceInts</a> (<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> cf,
<a name="l00588"></a>00588                                             <a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> of)<span class="keyword"> const</span>
<a name="l00589"></a>00589 <span class="keyword"></span>{
<a name="l00590"></a>00590   <span class="comment">// get face vertex coordinates</span>
<a name="l00591"></a>00591   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * cv0=NULL;
<a name="l00592"></a>00592   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * cv1=NULL;
<a name="l00593"></a>00593   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * cv2=NULL;
<a name="l00594"></a>00594   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * ov0=NULL;
<a name="l00595"></a>00595   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * ov1=NULL;
<a name="l00596"></a>00596   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * ov2=NULL;
<a name="l00597"></a>00597   cf-&gt;<a class="code" href="classFace.html#824ae8391bf1b3a3308734cd2f986254">getVertexCoord</a>(cv0,cv1,cv2);
<a name="l00598"></a>00598   of-&gt;<a class="code" href="classFace.html#824ae8391bf1b3a3308734cd2f986254">getVertexCoord</a>(ov0,ov1,ov2);
<a name="l00599"></a>00599   <span class="comment">// get number of unique vertices between current and other face</span>
<a name="l00600"></a>00600   <span class="keywordtype">int</span> single_shared_vert[2]={-1,-1};
<a name="l00601"></a>00601   <span class="keywordtype">int</span> num_unique = <a class="code" href="classIntersecting__Faces.html#597d75d052a44ef1b8eeb933cac7eadf">numUniqueVertices</a>(cf,of,single_shared_vert);
<a name="l00602"></a>00602   <span class="comment">// decision tree</span>
<a name="l00603"></a>00603   <span class="keywordflow">if</span> (<a class="code" href="classIntersecting__Faces.html#8aa976ef7b7f18ba88985889692e42d5">facesCoplanar</a>(cf,of)==<span class="keyword">true</span>)
<a name="l00604"></a>00604   {
<a name="l00605"></a>00605     <span class="keywordflow">if</span> (num_unique == 3)
<a name="l00606"></a>00606     {
<a name="l00607"></a>00607       <span class="comment">// polygons are identical</span>
<a name="l00608"></a>00608       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00609"></a>00609     }
<a name="l00610"></a>00610     <span class="keywordflow">else</span>
<a name="l00611"></a>00611     {
<a name="l00612"></a>00612       <span class="comment">// do polygon edges intersect?    </span>
<a name="l00613"></a>00613       <span class="keywordflow">if</span> (<a class="code" href="classIntersecting__Faces.html#a7a53aa8565e7a4769eb3fed0c0b8d14">checkEdgeEdgeIntersection</a>(cf,of,num_unique==4)==<span class="keyword">true</span>) {<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00614"></a>00614       <span class="keywordflow">else</span> {<span class="keywordflow">return</span> <span class="keyword">false</span>;}
<a name="l00615"></a>00615     }
<a name="l00616"></a>00616   }
<a name="l00617"></a>00617   <span class="keywordflow">else</span>
<a name="l00618"></a>00618   {
<a name="l00619"></a>00619     <span class="keywordflow">if</span> (num_unique==5)
<a name="l00620"></a>00620     {
<a name="l00621"></a>00621       <span class="comment">// single vertex shared</span>
<a name="l00622"></a>00622       <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * target1 = cv0;
<a name="l00623"></a>00623       <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * target2 = cv1;
<a name="l00624"></a>00624       <span class="comment">// check intersection of current face edge with other face</span>
<a name="l00625"></a>00625       <span class="keywordflow">if</span> (single_shared_vert[0]==0){target1 = cv1;target2 = cv2;}
<a name="l00626"></a>00626       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (single_shared_vert[0]==1){target2 = cv2;}
<a name="l00627"></a>00627       <a class="code" href="structresult.html">result</a> r = <a class="code" href="misc_8cc.html#2103a6d3f2d61e3c53ae964e0b866798">checkLineFaceInt</a>(of,*target1,*target2,<span class="keyword">false</span>);
<a name="l00628"></a>00628       <span class="keywordflow">if</span> (r.<a class="code" href="structresult.html#863743df4ba769d16c7a7596a7ab00d3">line_flag</a> &amp;&amp; (r.<a class="code" href="structresult.html#a17567c5f302f2f166926fce371a3235">poly_flag</a> || r.<a class="code" href="structresult.html#4ef7154e57c1ccee2103f378e12c7438">poly_edge_flag</a>)) {<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00629"></a>00629       <span class="comment">// check intersection of other face edge with current face</span>
<a name="l00630"></a>00630       target1 = ov0;
<a name="l00631"></a>00631       target2 = ov1;
<a name="l00632"></a>00632       <span class="keywordflow">if</span> (single_shared_vert[1]==0){target1 = ov1;target2 = ov2;}
<a name="l00633"></a>00633       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (single_shared_vert[1]==1){target2 = ov2;}
<a name="l00634"></a>00634       r = <a class="code" href="misc_8cc.html#2103a6d3f2d61e3c53ae964e0b866798">checkLineFaceInt</a>(cf,*target1,*target2,<span class="keyword">false</span>);
<a name="l00635"></a>00635       <span class="keywordflow">if</span> (r.<a class="code" href="structresult.html#863743df4ba769d16c7a7596a7ab00d3">line_flag</a> &amp;&amp; (r.<a class="code" href="structresult.html#a17567c5f302f2f166926fce371a3235">poly_flag</a> || r.<a class="code" href="structresult.html#4ef7154e57c1ccee2103f378e12c7438">poly_edge_flag</a>)) {<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00636"></a>00636       <span class="comment">// no face intersection</span>
<a name="l00637"></a>00637       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00638"></a>00638     }
<a name="l00639"></a>00639     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(num_unique==4))
<a name="l00640"></a>00640     {
<a name="l00641"></a>00641       <span class="comment">// faces do not share an edge</span>
<a name="l00642"></a>00642       <span class="keywordflow">if</span> (<a class="code" href="classIntersecting__Faces.html#47515b127106d6a452800ca7d05aef0b">checkFaceEdgeIntersection</a>(cf,of)) {<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00643"></a>00643       <span class="keywordflow">else</span> {<span class="keywordflow">return</span> <span class="keyword">false</span>;}
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645     <span class="keywordflow">else</span> { <span class="keywordflow">return</span> <span class="keyword">false</span>;}
<a name="l00646"></a>00646   }
<a name="l00647"></a>00647 }
<a name="l00648"></a>00648 
<a name="l00659"></a><a class="code" href="classIntersecting__Faces.html#597d75d052a44ef1b8eeb933cac7eadf">00659</a> <span class="keywordtype">int</span> <a class="code" href="classIntersecting__Faces.html#597d75d052a44ef1b8eeb933cac7eadf">Intersecting_Faces::numUniqueVertices</a> (<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> cf,
<a name="l00660"></a>00660                                            <a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> of,
<a name="l00661"></a>00661                                            <span class="keywordtype">int</span>  * <span class="keyword">const</span> single_shared_vert)<span class="keyword"> const</span>
<a name="l00662"></a>00662 <span class="keyword"></span>{
<a name="l00663"></a>00663   <span class="keywordtype">int</span> num_unique = 0;
<a name="l00664"></a>00664   <span class="comment">// for each current face vertex</span>
<a name="l00665"></a>00665   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++)
<a name="l00666"></a>00666   {
<a name="l00667"></a>00667     <span class="comment">// for each other face vertex</span>
<a name="l00668"></a>00668     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;3;k++)
<a name="l00669"></a>00669     {
<a name="l00670"></a>00670       <span class="keywordflow">if</span> (cf-&gt;<a class="code" href="classFace.html#e41ceba59412e800cf29a1847c5c10bf">getVertex</a>(j)!=of-&gt;<a class="code" href="classFace.html#e41ceba59412e800cf29a1847c5c10bf">getVertex</a>(k))
<a name="l00671"></a>00671       {
<a name="l00672"></a>00672         num_unique++;
<a name="l00673"></a>00673       }
<a name="l00674"></a>00674       <span class="keywordflow">else</span>
<a name="l00675"></a>00675       {
<a name="l00676"></a>00676         single_shared_vert[0]=j;
<a name="l00677"></a>00677         single_shared_vert[1]=k;
<a name="l00678"></a>00678       }
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680   }
<a name="l00681"></a>00681   <span class="keywordflow">return</span> num_unique-3;
<a name="l00682"></a>00682 }
<a name="l00683"></a>00683 
<a name="l00691"></a><a class="code" href="classIntersecting__Faces.html#bdd45262cca89eafcdbe8e2c40560001">00691</a> <span class="keywordtype">bool</span> <a class="code" href="classIntersecting__Faces.html#bdd45262cca89eafcdbe8e2c40560001">Intersecting_Faces::facesParallel</a> (<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> cf,
<a name="l00692"></a>00692                                         <a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> of)<span class="keyword"> const</span>
<a name="l00693"></a>00693 <span class="keyword"></span>{
<a name="l00694"></a>00694   <span class="comment">// get face normals</span>
<a name="l00695"></a>00695   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> cn = cf-&gt;<a class="code" href="classFace.html#c562850fda0a0725a6aebbc80ababa20">getNormal</a>();
<a name="l00696"></a>00696   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> on = of-&gt;<a class="code" href="classFace.html#c562850fda0a0725a6aebbc80ababa20">getNormal</a>();
<a name="l00697"></a>00697   <span class="comment">// are current face and other face parallel</span>
<a name="l00698"></a>00698   <span class="comment">// i.e. is angle between normals equal to zero?</span>
<a name="l00699"></a>00699   <span class="comment">// i.e. is the square of the cosine of the angle equal to 1?</span>
<a name="l00700"></a>00700   <span class="keywordflow">if</span> (!<a class="code" href="misc_8cc.html#7db6aafb6cea1e9db8da40c90de56269">distinguishable</a>(<a class="code" href="misc_8cc.html#aa2064e9e93d580841bffe746925cc8f">dot</a>(cn,on)*<a class="code" href="misc_8cc.html#aa2064e9e93d580841bffe746925cc8f">dot</a>(cn,on),<a class="code" href="misc_8cc.html#aa2064e9e93d580841bffe746925cc8f">dot</a>(cn,cn)*<a class="code" href="misc_8cc.html#aa2064e9e93d580841bffe746925cc8f">dot</a>(on,on))) {<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00701"></a>00701   <span class="keywordflow">else</span> {<span class="keywordflow">return</span> <span class="keyword">false</span>;}
<a name="l00702"></a>00702 }
<a name="l00703"></a>00703 
<a name="l00711"></a><a class="code" href="classIntersecting__Faces.html#8aa976ef7b7f18ba88985889692e42d5">00711</a> <span class="keywordtype">bool</span> <a class="code" href="classIntersecting__Faces.html#8aa976ef7b7f18ba88985889692e42d5">Intersecting_Faces::facesCoplanar</a> (<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> cf,
<a name="l00712"></a>00712                                         <a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> of)<span class="keyword"> const</span>
<a name="l00713"></a>00713 <span class="keyword"></span>{
<a name="l00714"></a>00714   <span class="comment">// check for parallelism</span>
<a name="l00715"></a>00715   <span class="keywordflow">if</span> (<a class="code" href="classIntersecting__Faces.html#bdd45262cca89eafcdbe8e2c40560001">facesParallel</a>(cf,of)==<span class="keyword">false</span>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00716"></a>00716   <span class="comment">// faces are parallel</span>
<a name="l00717"></a>00717   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * cv0=NULL;
<a name="l00718"></a>00718   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * cv1=NULL;
<a name="l00719"></a>00719   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * cv2=NULL;
<a name="l00720"></a>00720   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * ov0=NULL;
<a name="l00721"></a>00721   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * ov1=NULL;
<a name="l00722"></a>00722   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * ov2=NULL;
<a name="l00723"></a>00723   <span class="comment">// get face vertex coordinates</span>
<a name="l00724"></a>00724   cf-&gt;<a class="code" href="classFace.html#824ae8391bf1b3a3308734cd2f986254">getVertexCoord</a>(cv0,cv1,cv2);
<a name="l00725"></a>00725   of-&gt;<a class="code" href="classFace.html#824ae8391bf1b3a3308734cd2f986254">getVertexCoord</a>(ov0,ov1,ov2);
<a name="l00726"></a>00726   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * o_target = ov2;
<a name="l00727"></a>00727   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * c_target = cv2;
<a name="l00728"></a>00728   <span class="comment">// get face vertex indices</span>
<a name="l00729"></a>00729   <span class="keywordtype">int</span> cvi[3] = {cf-&gt;<a class="code" href="classFace.html#e41ceba59412e800cf29a1847c5c10bf">getVertex</a>(0)-&gt;<a class="code" href="classVertex.html#0487c340a3a1559f4a8e45d8a7b0f9e2">getIndex</a>(),
<a name="l00730"></a>00730                  cf-&gt;<a class="code" href="classFace.html#e41ceba59412e800cf29a1847c5c10bf">getVertex</a>(1)-&gt;<a class="code" href="classVertex.html#0487c340a3a1559f4a8e45d8a7b0f9e2">getIndex</a>(),
<a name="l00731"></a>00731                  cf-&gt;<a class="code" href="classFace.html#e41ceba59412e800cf29a1847c5c10bf">getVertex</a>(2)-&gt;<a class="code" href="classVertex.html#0487c340a3a1559f4a8e45d8a7b0f9e2">getIndex</a>()};
<a name="l00732"></a>00732   <span class="keywordtype">int</span> ovi[3] = {of-&gt;<a class="code" href="classFace.html#e41ceba59412e800cf29a1847c5c10bf">getVertex</a>(0)-&gt;<a class="code" href="classVertex.html#0487c340a3a1559f4a8e45d8a7b0f9e2">getIndex</a>(),
<a name="l00733"></a>00733                  of-&gt;<a class="code" href="classFace.html#e41ceba59412e800cf29a1847c5c10bf">getVertex</a>(1)-&gt;<a class="code" href="classVertex.html#0487c340a3a1559f4a8e45d8a7b0f9e2">getIndex</a>(),
<a name="l00734"></a>00734                  of-&gt;<a class="code" href="classFace.html#e41ceba59412e800cf29a1847c5c10bf">getVertex</a>(2)-&gt;<a class="code" href="classVertex.html#0487c340a3a1559f4a8e45d8a7b0f9e2">getIndex</a>()};
<a name="l00735"></a>00735   <span class="comment">// get face normal</span>
<a name="l00736"></a>00736   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> on = of-&gt;<a class="code" href="classFace.html#c562850fda0a0725a6aebbc80ababa20">getNormal</a>();
<a name="l00737"></a>00737   <span class="comment">// dot product of other face normal and </span>
<a name="l00738"></a>00738   <span class="comment">// line connecting point on other face to point on current face</span>
<a name="l00739"></a>00739   <span class="comment">// try to choose vertices not shared by both face</span>
<a name="l00740"></a>00740   <span class="keywordflow">if</span>      ((ovi[0]!=cvi[0])&amp;&amp;(ovi[0]!=cvi[1])&amp;&amp;(ovi[0]!=cvi[2])) {o_target=ov0;}
<a name="l00741"></a>00741   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ovi[1]!=cvi[0])&amp;&amp;(ovi[1]!=cvi[1])&amp;&amp;(ovi[2]!=cvi[2])) {o_target=ov1;}
<a name="l00742"></a>00742   <span class="keywordflow">if</span>      ((cvi[0]!=ovi[0])&amp;&amp;(cvi[0]!=ovi[1])&amp;&amp;(cvi[0]!=ovi[2])) {c_target=cv0;}
<a name="l00743"></a>00743   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((cvi[1]!=ovi[0])&amp;&amp;(cvi[1]!=ovi[1])&amp;&amp;(cvi[1]!=ovi[2])) {c_target=cv1;}
<a name="l00744"></a>00744   <span class="comment">// if polygons colinear, then normal and line are orthogonal</span>
<a name="l00745"></a>00745   <span class="comment">// and dot product will be ~zero</span>
<a name="l00746"></a>00746   <span class="keywordflow">if</span> (fabs(on[0]*((*o_target)[0]-(*c_target)[0])
<a name="l00747"></a>00747           +on[1]*((*o_target)[1]-(*c_target)[1])
<a name="l00748"></a>00748           +on[2]*((*o_target)[2]-(*c_target)[2]))&lt;<a class="code" href="controls_8h.html#06b7ca91a439f4edad3563357c58efb3">DOUBLE_EPSILON</a>) {<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00749"></a>00749   <span class="keywordflow">else</span> {<span class="keywordflow">return</span> <span class="keyword">false</span>;}
<a name="l00750"></a>00750 }
<a name="l00751"></a>00751 
<a name="l00761"></a><a class="code" href="classIntersecting__Faces.html#a7a53aa8565e7a4769eb3fed0c0b8d14">00761</a> <span class="keywordtype">bool</span> <a class="code" href="classIntersecting__Faces.html#a7a53aa8565e7a4769eb3fed0c0b8d14">Intersecting_Faces::checkEdgeEdgeIntersection</a> (<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> cf,
<a name="l00762"></a>00762                                                    <a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> of,
<a name="l00763"></a>00763                                                    <span class="keywordtype">bool</span> <span class="keyword">const</span> share_edge_flag)<span class="keyword"> const</span>
<a name="l00764"></a>00764 <span class="keyword"></span>{
<a name="l00765"></a>00765   <span class="keywordtype">int</span> pairs[3][2] = {{0,1},{1,2},{2,0}};
<a name="l00766"></a>00766   <span class="comment">// cpvc = current_polygon_vertex_coordinates</span>
<a name="l00767"></a>00767   <span class="comment">// opvc = other_polygon_vertex_coordinates</span>
<a name="l00768"></a>00768   <span class="comment">// cv   = current_vertex</span>
<a name="l00769"></a>00769   <span class="comment">// ov   = other_vertex</span>
<a name="l00770"></a>00770   <a class="code" href="classVertex.html">Vertex</a> *cv[2],*ov[2];
<a name="l00771"></a>00771   <span class="comment">// for each current face edge</span>
<a name="l00772"></a>00772   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++)
<a name="l00773"></a>00773   {
<a name="l00774"></a>00774     <span class="comment">// for each other face edge</span>
<a name="l00775"></a>00775     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++)
<a name="l00776"></a>00776     {
<a name="l00777"></a>00777       cv[0] = cf-&gt;<a class="code" href="classFace.html#e41ceba59412e800cf29a1847c5c10bf">getVertex</a>(pairs[i][0]);
<a name="l00778"></a>00778       cv[1] = cf-&gt;<a class="code" href="classFace.html#e41ceba59412e800cf29a1847c5c10bf">getVertex</a>(pairs[i][1]);
<a name="l00779"></a>00779       ov[0] = of-&gt;<a class="code" href="classFace.html#e41ceba59412e800cf29a1847c5c10bf">getVertex</a>(pairs[j][0]);
<a name="l00780"></a>00780       ov[1] = of-&gt;<a class="code" href="classFace.html#e41ceba59412e800cf29a1847c5c10bf">getVertex</a>(pairs[j][0]);
<a name="l00781"></a>00781       <span class="comment">// if the edges do not share a vertex</span>
<a name="l00782"></a>00782       <span class="keywordflow">if</span> (cv[0]!=ov[0]&amp;&amp;cv[0]!=ov[1]&amp;&amp;cv[1]!=ov[0]&amp;&amp;cv[1]!=ov[1])
<a name="l00783"></a>00783       {
<a name="l00784"></a>00784         <span class="comment">// and the edges are not parallel</span>
<a name="l00785"></a>00785         <span class="keywordtype">double</span> x[3],y[3];
<a name="l00786"></a>00786         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;3;k++)
<a name="l00787"></a>00787         {
<a name="l00788"></a>00788           x[k] = cv[1]-&gt;getCoord(k)-cv[0]-&gt;getCoord(k);
<a name="l00789"></a>00789           y[k] = ov[1]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(k)-ov[0]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(k);
<a name="l00790"></a>00790         }
<a name="l00791"></a>00791         <span class="keywordflow">if</span> (<a class="code" href="misc_8cc.html#7db6aafb6cea1e9db8da40c90de56269">distinguishable</a>(<a class="code" href="misc_8cc.html#aa2064e9e93d580841bffe746925cc8f">dot</a>(x,y)*<a class="code" href="misc_8cc.html#aa2064e9e93d580841bffe746925cc8f">dot</a>(x,y),<a class="code" href="misc_8cc.html#aa2064e9e93d580841bffe746925cc8f">dot</a>(x,x)*<a class="code" href="misc_8cc.html#aa2064e9e93d580841bffe746925cc8f">dot</a>(y,y))==<span class="keyword">true</span>)
<a name="l00792"></a>00792         {
<a name="l00793"></a>00793           <span class="comment">// compute scalars</span>
<a name="l00794"></a>00794           <span class="keywordtype">double</span> qDen = (cv[1]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(0)-cv[0]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(0))
<a name="l00795"></a>00795                        *(ov[1]-&gt;getCoord(1)-ov[0]-&gt;getCoord(1))
<a name="l00796"></a>00796                        -(cv[1]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(1)-cv[0]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(1))
<a name="l00797"></a>00797                        *(ov[1]-&gt;getCoord(0)-ov[0]-&gt;getCoord(0));
<a name="l00798"></a>00798           <span class="keywordtype">double</span> qNum = (cv[1]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(0)-cv[0]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(0))
<a name="l00799"></a>00799                        *(cv[0]-&gt;getCoord(1)-ov[0]-&gt;getCoord(1))
<a name="l00800"></a>00800                        -(cv[1]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(1)-cv[0]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(1))
<a name="l00801"></a>00801                        *(cv[0]-&gt;getCoord(0)-ov[0]-&gt;getCoord(0));
<a name="l00802"></a>00802           <span class="keywordtype">double</span> q = qNum/qDen;
<a name="l00803"></a>00803           <span class="keywordtype">double</span> uNum = ov[0]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(0)-cv[0]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(0)
<a name="l00804"></a>00804                     +q*(ov[1]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(0)-ov[0]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(0));
<a name="l00805"></a>00805           <span class="keywordtype">double</span> uDen = cv[1]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(0)-cv[0]-&gt;<a class="code" href="classVertex.html#e77b7638155ba654b0bee000e8f3eaf2">getCoord</a>(0);
<a name="l00806"></a>00806           <span class="keywordflow">if</span>(fabs(qDen)&gt;<a class="code" href="controls_8h.html#06b7ca91a439f4edad3563357c58efb3">DOUBLE_EPSILON</a> &amp;&amp; fabs(uDen)&gt;<a class="code" href="controls_8h.html#06b7ca91a439f4edad3563357c58efb3">DOUBLE_EPSILON</a>)
<a name="l00807"></a>00807           {
<a name="l00808"></a>00808             <span class="keywordtype">double</span> u = uNum/uDen;
<a name="l00809"></a>00809             <span class="keywordflow">if</span> (((u &gt; <a class="code" href="controls_8h.html#06b7ca91a439f4edad3563357c58efb3">DOUBLE_EPSILON</a> &amp;&amp; u &lt; (1-<a class="code" href="controls_8h.html#06b7ca91a439f4edad3563357c58efb3">DOUBLE_EPSILON</a>)) &amp;&amp; 
<a name="l00810"></a>00810                  (q &gt; <a class="code" href="controls_8h.html#06b7ca91a439f4edad3563357c58efb3">DOUBLE_EPSILON</a> &amp;&amp; q &lt; (1-<a class="code" href="controls_8h.html#06b7ca91a439f4edad3563357c58efb3">DOUBLE_EPSILON</a>)) ) ||
<a name="l00811"></a>00811                 ( share_edge_flag &amp;&amp; ((u &gt; <a class="code" href="controls_8h.html#06b7ca91a439f4edad3563357c58efb3">DOUBLE_EPSILON</a> &amp;&amp; u &lt; (1-<a class="code" href="controls_8h.html#06b7ca91a439f4edad3563357c58efb3">DOUBLE_EPSILON</a>)) || 
<a name="l00812"></a>00812                                       (q &gt; <a class="code" href="controls_8h.html#06b7ca91a439f4edad3563357c58efb3">DOUBLE_EPSILON</a> &amp;&amp; q &lt; (1-<a class="code" href="controls_8h.html#06b7ca91a439f4edad3563357c58efb3">DOUBLE_EPSILON</a>))) ))
<a name="l00813"></a>00813             {
<a name="l00814"></a>00814               <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00815"></a>00815             }
<a name="l00816"></a>00816           }
<a name="l00817"></a>00817         }
<a name="l00818"></a>00818       }
<a name="l00819"></a>00819     }
<a name="l00820"></a>00820   }
<a name="l00821"></a>00821   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00822"></a>00822 }
<a name="l00823"></a>00823 
<a name="l00831"></a><a class="code" href="classIntersecting__Faces.html#47515b127106d6a452800ca7d05aef0b">00831</a> <span class="keywordtype">bool</span> <a class="code" href="classIntersecting__Faces.html#47515b127106d6a452800ca7d05aef0b">Intersecting_Faces::checkFaceEdgeIntersection</a> (<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> cf,<a class="code" href="classFace.html">Face</a> <span class="keyword">const</span> * <span class="keyword">const</span> of)<span class="keyword"> const</span>
<a name="l00832"></a>00832 <span class="keyword"></span>{
<a name="l00833"></a>00833   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * v0=NULL;
<a name="l00834"></a>00834   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * v1=NULL;
<a name="l00835"></a>00835   <a class="code" href="meshmorph_8h.html#db0ab3db1ab685e2d2bff657e3e86861">vec_d</a> <span class="keyword">const</span> * v2=NULL;  
<a name="l00836"></a>00836   <span class="comment">// get face vertex coordinates</span>
<a name="l00837"></a>00837   cf-&gt;<a class="code" href="classFace.html#824ae8391bf1b3a3308734cd2f986254">getVertexCoord</a>(v0,v1,v2);
<a name="l00838"></a>00838   <span class="comment">// for each current face edge</span>
<a name="l00839"></a>00839   <a class="code" href="structresult.html">result</a> r = <a class="code" href="misc_8cc.html#2103a6d3f2d61e3c53ae964e0b866798">checkLineFaceInt</a>(of,*v0,*v1,<span class="keyword">false</span>);
<a name="l00840"></a>00840   <span class="keywordflow">if</span>(!r.<a class="code" href="structresult.html#863743df4ba769d16c7a7596a7ab00d3">line_flag</a> || !r.<a class="code" href="structresult.html#a17567c5f302f2f166926fce371a3235">poly_flag</a>)
<a name="l00841"></a>00841   {
<a name="l00842"></a>00842     r = <a class="code" href="misc_8cc.html#2103a6d3f2d61e3c53ae964e0b866798">checkLineFaceInt</a>(of,*v1,*v2,<span class="keyword">false</span>);
<a name="l00843"></a>00843   }
<a name="l00844"></a>00844   <span class="keywordflow">if</span>(!r.<a class="code" href="structresult.html#863743df4ba769d16c7a7596a7ab00d3">line_flag</a> || !r.<a class="code" href="structresult.html#a17567c5f302f2f166926fce371a3235">poly_flag</a>)
<a name="l00845"></a>00845   {
<a name="l00846"></a>00846     <a class="code" href="misc_8cc.html#2103a6d3f2d61e3c53ae964e0b866798">checkLineFaceInt</a>(of,*v2,*v0,<span class="keyword">false</span>);
<a name="l00847"></a>00847   }
<a name="l00848"></a>00848   <span class="keywordflow">if</span> (r.<a class="code" href="structresult.html#863743df4ba769d16c7a7596a7ab00d3">line_flag</a> &amp;&amp; (r.<a class="code" href="structresult.html#a17567c5f302f2f166926fce371a3235">poly_flag</a> || r.<a class="code" href="structresult.html#4ef7154e57c1ccee2103f378e12c7438">poly_edge_flag</a>)) {<span class="keywordflow">return</span>(1);}
<a name="l00849"></a>00849   <span class="comment">// get face vertex coordinates</span>
<a name="l00850"></a>00850   of-&gt;<a class="code" href="classFace.html#824ae8391bf1b3a3308734cd2f986254">getVertexCoord</a>(v0,v1,v2);
<a name="l00851"></a>00851   <span class="comment">// for each other face edge</span>
<a name="l00852"></a>00852   r = <a class="code" href="misc_8cc.html#2103a6d3f2d61e3c53ae964e0b866798">checkLineFaceInt</a>(cf,*v0,*v1,<span class="keyword">false</span>);
<a name="l00853"></a>00853   <span class="keywordflow">if</span>(!r.<a class="code" href="structresult.html#863743df4ba769d16c7a7596a7ab00d3">line_flag</a> || !r.<a class="code" href="structresult.html#a17567c5f302f2f166926fce371a3235">poly_flag</a>)
<a name="l00854"></a>00854   {
<a name="l00855"></a>00855     r = <a class="code" href="misc_8cc.html#2103a6d3f2d61e3c53ae964e0b866798">checkLineFaceInt</a>(cf,*v1,*v2,<span class="keyword">false</span>);
<a name="l00856"></a>00856   }
<a name="l00857"></a>00857   <span class="keywordflow">if</span>(!r.<a class="code" href="structresult.html#863743df4ba769d16c7a7596a7ab00d3">line_flag</a> || !r.<a class="code" href="structresult.html#a17567c5f302f2f166926fce371a3235">poly_flag</a>)
<a name="l00858"></a>00858   {
<a name="l00859"></a>00859     r = <a class="code" href="misc_8cc.html#2103a6d3f2d61e3c53ae964e0b866798">checkLineFaceInt</a>(cf,*v2,*v0,<span class="keyword">false</span>);
<a name="l00860"></a>00860   }
<a name="l00861"></a>00861   <span class="comment">// do face intersect?</span>
<a name="l00862"></a>00862   <span class="keywordflow">if</span> (r.<a class="code" href="structresult.html#863743df4ba769d16c7a7596a7ab00d3">line_flag</a> &amp;&amp; (r.<a class="code" href="structresult.html#a17567c5f302f2f166926fce371a3235">poly_flag</a> || r.<a class="code" href="structresult.html#4ef7154e57c1ccee2103f378e12c7438">poly_edge_flag</a>)) {<span class="keywordflow">return</span> <span class="keyword">true</span>;}
<a name="l00863"></a>00863   <span class="keywordflow">else</span> {<span class="keywordflow">return</span> <span class="keyword">false</span>;}
<a name="l00864"></a>00864 }
<a name="l00865"></a>00865 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Jul 18 19:43:39 2008 for meshmorph by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
