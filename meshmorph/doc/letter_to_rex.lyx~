#LyX 1.3 created this file. For more info see http://www.lyx.org/
\lyxformat 221
\textclass article
\language english
\inputencoding auto
\fontscheme default
\graphics default
\paperfontsize default
\spacing single 
\papersize Default
\paperpackage a4
\use_geometry 1
\use_amsmath 0
\use_natbib 0
\use_numerical_citations 0
\paperorientation portrait
\leftmargin 0.5in
\topmargin 0.5in
\rightmargin 0.5in
\bottommargin 0.5in
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\defskip medskip
\quotes_language english
\quotes_times 2
\papercolumns 1
\papersides 1
\paperpagestyle default

\layout Standard

Dear Rex,
\layout Standard

I thought that you might like an update on the meshprimp project.
 Your interest in the project and contributions to the methods are welcome
 indeed.
 Currently, I'm struggling with computing the net force on a vertex for
 two reasons.
 First, I'm not sure which forces to include in the free-body diagram.
 Second, my derivation of the angle of an edge includes the cosine of the
 angle.
 Since cosine is an even function, I lose information about the sign of
 the angle.
 
\layout Standard

justin
\layout Section

Algorithm overview
\layout Standard

The c++ code for moving vertices does so one vertex at a time.
 However, there are too many vertices in the data set to move them all m
 times.
 Instead, we choose to compute the virtual displacement of each vertex during
 initialization and move the vertex with the largest virtual displacement
 first.
 The virtual displacement of a vertex is how far it would move if the spring
 forces on the vertex were allowed to equilibrate.
 Our design philosophy is to maintain the state of the spring model by tracking
 changes in the spring configuration during vertex moves, so that we can
 also maintain a sorted list of virtual displacements.
 Futhermore, we are starting with a mesh that has no intersecting faces
 within the same object or between different objects, and all edge angles
 are greater than zero radians and less than 
\begin_inset Formula $2\pi$
\end_inset 

 radians.
 Since the code monitors edge angles and face intersections, any vertex
 move that results in an intersection, i.e.
 a collision, will be undone.
\layout Section

Analytical expression for the net force on a vertex
\layout Standard

Technically, all forces in the data set are internal forces to the system
 and the displacement of each vertex should be computed in parallel.
 But suppose we wanted to discretize the problem by solving an approximate
 expression for the local forces on a vertex.
 In other words we would define a fixed boundary around the current vertex.
 This fixed boundary is equivalent to applying reaction forces to these
 boundary vertices.
 
\series bold 
Where do we put the boundary?
\series default 
 Figure 
\begin_inset LatexCommand \ref{cap:(A)-Patch-from}

\end_inset 

 illustrates how the boundary is currently implemented.
\layout Standard


\begin_inset Float figure
placement H
wide false
collapsed false

\layout Standard


\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
center
\end_inset 


\layout Standard


\begin_inset Graphics
	filename vertex_forces5.png

\end_inset 


\layout Caption


\begin_inset LatexCommand \label{cap:(A)-Patch-from}

\end_inset 

(A) Patch from example mesh object.
 The red surface is exposed to the extracellular space, while the blue surface
 is intracellular.
 (B) V, current vertex.
 C, closest point to V, if any.
 Edge e contributes to force on vertex v as either a linear spring, 
\begin_inset Formula $e_{l}$
\end_inset 

, where the spring force is equal to the product of the spring constant
 and the spring stretch (current length - resting length), or as an angular
 spring, 
\begin_inset Formula $e_{a}$
\end_inset 

, where the spring force is equal to the product of the spring constant
 and the spring stretch (current angle - resting angle).
 The vertices defining the angular springs (
\begin_inset Formula $e_{a}$
\end_inset 

 in figure) constitute the fixed boundary.
 Angular springs on the 
\begin_inset Formula $e_{l}$
\end_inset 

 edges are NOT contributing to the force at v.
 
\series bold 
Is this an erroneous ommision?
\series default 
 Note that c is the closest point to v outside of v's neighborhood.
 c may lie on a face, an edge, or another vertex.
 Also note that the closest point to other vertices around v may lie on
 an adjacent face of v, yet NO contribution to the force on v is calculated.
 
\series bold 
Is this an unacceptable ommision?
\end_inset 


\layout Standard

Once the boundary has been decided, can we formulate all forces on the current
 vertex as a system of linear equations and solve for the equilibrium position?
 The answer to this question depends on the success of linearizing the edge
 angle force as seen below.
\layout Section

Edge angle force contribution
\layout Standard

An edge is defined by two mesh vertices 
\begin_inset Formula $\overrightarrow{v_{1}}$
\end_inset 

 and 
\begin_inset Formula $\overrightarrow{v_{2}}$
\end_inset 

, and two adjacent faces 
\begin_inset Formula $f_{1}$
\end_inset 

 and 
\begin_inset Formula $f_{2}$
\end_inset 

 (Figure 
\begin_inset LatexCommand \ref{cap:Edge-structure.}

\end_inset 

).
 The faces 
\begin_inset Formula $f_{1}$
\end_inset 

 and 
\begin_inset Formula $f_{2}$
\end_inset 

 each have a third vertex in addition to 
\begin_inset Formula $\overrightarrow{v_{1}}$
\end_inset 

 and 
\begin_inset Formula $\overrightarrow{v_{2}}$
\end_inset 

, designated 
\begin_inset Formula $\overrightarrow{o_{1}}$
\end_inset 

 and 
\begin_inset Formula $\overrightarrow{o_{2}}$
\end_inset 

, respectively.
 Each face also has an outward normal vector computed using the face vertices.
\layout Standard


\begin_inset Float figure
placement H
wide false
collapsed false

\layout Standard


\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
center
\end_inset 


\layout Standard


\begin_inset Graphics
	filename edge_structure.png

\end_inset 


\layout Caption


\begin_inset LatexCommand \label{cap:Edge-structure.}

\end_inset 

Edge structure.
\end_inset 


\layout Standard

As shown in Figure 
\begin_inset LatexCommand \label{cap:(Left)-gamma-measures}

\end_inset 

A, let 
\begin_inset Formula $\overrightarrow{I_{j}}$
\end_inset 

 (
\begin_inset Formula $j=1,2$
\end_inset 

) be the intersection point of the line segment 
\begin_inset Formula $\overline{v_{1}v_{2}}$
\end_inset 

 and a perpendicular line passing through 
\begin_inset Formula $\overrightarrow{o_{j}}$
\end_inset 

.
 Define 
\begin_inset Formula $\overrightarrow{r_{j}}=\overrightarrow{o_{j}}-\overrightarrow{I_{j}}$
\end_inset 

.
 Let angle 
\begin_inset Formula $\gamma$
\end_inset 

 measure the stretch of the angular spring.
 Then the spring moment 
\begin_inset Formula $\overrightarrow{M_{j}}$
\end_inset 

 is equivalent to 
\begin_inset Formula $\overrightarrow{r_{j}}\times\overrightarrow{F_{j}}$
\end_inset 

 (Figure 
\begin_inset LatexCommand \label{cap:(Left)-gamma-measures}

\end_inset 

B).
 Assuming the magnitude of the spring moment varies linearly with spring
 stretch., then 
\begin_inset Formula $\left|\overrightarrow{M_{j}}\right|=k\gamma$
\end_inset 

.
 We want 
\begin_inset Formula $-\pi\leq\gamma\leq\pi$
\end_inset 

 over the range 
\begin_inset Formula $0\leq\theta\leq2\pi$
\end_inset 

 so the spring moment is restorative.
\layout Standard


\begin_inset Float figure
placement H
wide false
collapsed false

\layout Standard


\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
center
\end_inset 


\layout Standard


\begin_inset Graphics
	filename vertex_forces3.png

\end_inset 


\layout Caption


\begin_inset LatexCommand \label{cap:(Left)-gamma-measures}

\end_inset 

(A) 
\begin_inset Formula $\gamma$
\end_inset 

 measures the stretch of the angular spring.
 When 
\begin_inset Formula $\gamma==0$
\end_inset 

 the edge is 
\begin_inset Quotes eld
\end_inset 

flat
\begin_inset Quotes erd
\end_inset 

, i.e.
 the adjacent faces are coplanar and the angular spring is in it's resting
 position and generates no force.
 (B) The forces on both 
\begin_inset Formula $\overrightarrow{o_{1}}$
\end_inset 

 and 
\begin_inset Formula $\overrightarrow{o_{2}}$
\end_inset 

 are determined using the same value of 
\begin_inset Formula $\gamma$
\end_inset 

.
 Note the underline indicates a vector quantity.
\end_inset 


\layout Standard

Alternatively, the stretch angle 
\begin_inset Formula $\gamma$
\end_inset 

 can be reformulated as the edge open angle 
\begin_inset Formula $\theta$
\end_inset 

.
 Figure 
\begin_inset LatexCommand \ref{cap:Description-of-gamma,}

\end_inset 

 illustrates the calculation of 
\begin_inset Formula $\gamma$
\end_inset 

, 
\begin_inset Formula $\phi$
\end_inset 

, and 
\begin_inset Formula $\theta$
\end_inset 

 for two different edge orientations.
 For vertex position 
\begin_inset Formula $o_{2}$
\end_inset 

, 
\begin_inset Formula $\gamma>0$
\end_inset 

, 
\begin_inset Formula $0\leq\phi<\pi$
\end_inset 

 and 
\begin_inset Formula $0\leq\theta<\pi$
\end_inset 

,where as for 
\begin_inset Formula $o_{2}'$
\end_inset 

, 
\begin_inset Formula $\gamma'<0$
\end_inset 

, 
\begin_inset Formula $\pi<\phi'\leq2\pi$
\end_inset 

 and 
\begin_inset Formula $\pi<\theta'<2\pi$
\end_inset 

.
 It can be shown that 
\begin_inset Formula $\gamma+\theta=\pi$
\end_inset 

 for 
\begin_inset Formula $0\leq\theta\leq2\pi$
\end_inset 

, therefore an alternate expression for the magniatude of the moment is
 
\begin_inset Formula $\left|\overrightarrow{M_{j}}\right|=k\left(\pi-\theta\right)$
\end_inset 

.
 Therefore if 
\begin_inset Formula $\theta<\pi$
\end_inset 

 then 
\begin_inset Formula $\gamma>0$
\end_inset 

 and 
\begin_inset Formula $\left|\overrightarrow{M_{j}}\right|>0$
\end_inset 

, and if 
\begin_inset Formula $\theta>\pi$
\end_inset 

, then 
\begin_inset Formula $\gamma<0$
\end_inset 

 and 
\begin_inset Formula $\left|\overrightarrow{M_{j}}\right|<0$
\end_inset 

.
\layout Standard


\begin_inset Float figure
placement H
wide false
collapsed false

\layout Standard


\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
center
\end_inset 


\layout Standard


\begin_inset Graphics
	filename vertex_forces2_schematicsonly.png

\end_inset 


\layout Caption


\begin_inset LatexCommand \label{cap:Description-of-gamma,}

\end_inset 

Description of 
\begin_inset Formula $\gamma$
\end_inset 

, 
\begin_inset Formula $\phi$
\end_inset 

, and 
\begin_inset Formula $\theta$
\end_inset 

 for two different edge orientations defined by 
\begin_inset Formula $\overrightarrow{o_{2}}$
\end_inset 

 and 
\begin_inset Formula $\overrightarrow{o_{2}'}$
\end_inset 

.
 Note that
\begin_inset Formula $-\pi<\gamma<\pi$
\end_inset 

, 
\begin_inset Formula $0\leq\phi\leq\pi$
\end_inset 

, and 
\begin_inset Formula $0\leq\theta\leq2\pi$
\end_inset 

.
\end_inset 


\layout Subsection

Relationship between 
\begin_inset Formula $\phi$
\end_inset 

 and 
\begin_inset Formula $\gamma$
\end_inset 


\layout Standard

From Figure 
\begin_inset LatexCommand \ref{cap:Description-of-gamma,}

\end_inset 

 if 
\begin_inset Formula $\theta<\pi$
\end_inset 

, then 
\begin_inset Formula $cos\phi=\frac{\overrightarrow{s_{1}}\bullet\overrightarrow{s_{2}}}{\left|\overrightarrow{s_{1}}\right|\left|\overrightarrow{s_{2}}\right|}=cos\theta=cos\left(\pi-\gamma\right)=cos\pi cos\gamma+sin\pi sin\gamma=-cos\gamma$
\end_inset 

.
 However, because 
\begin_inset Formula $cos\gamma==cos\left(-\gamma\right)$
\end_inset 

, the equation effectively returns the absolute value of 
\begin_inset Formula $\gamma$
\end_inset 

.
 This is evident for 
\begin_inset Formula $\theta>\pi$
\end_inset 

 noting that now 
\begin_inset Formula $\gamma=\phi-\pi$
\end_inset 

.
 The same result above is derived, i.e.
 
\begin_inset Formula $cos\phi=-cos\gamma$
\end_inset 

.
 More information is needed to determine the sign of 
\begin_inset Formula $\gamma$
\end_inset 

.
 By trial and error it was found that 
\begin_inset Formula $\gamma$
\end_inset 

 is correctly calculated as follows.
 If 
\begin_inset Formula $0\leq\theta\leq\pi$
\end_inset 

 then 
\begin_inset Formula $cos\phi=-cos\gamma$
\end_inset 

, else if 
\begin_inset Formula $\pi\leq\theta\leq2\pi$
\end_inset 

 then 
\begin_inset Formula $cos\phi=-cos\left(-\gamma\right)$
\end_inset 

.
\layout Standard

How do we unify these two different relations between 
\begin_inset Formula $\gamma$
\end_inset 

 and 
\begin_inset Formula $\phi$
\end_inset 

? First, we reformulate the expression as 
\begin_inset Formula $cos\phi=-cos\left(a\gamma\right)$
\end_inset 

 where 
\begin_inset Formula $a=1$
\end_inset 

 for 
\begin_inset Formula $0\leq\theta<\pi$
\end_inset 

 and 
\begin_inset Formula $a=-1$
\end_inset 

 for 
\begin_inset Formula $\pi<\theta\leq2\pi$
\end_inset 

.
 By trial and error it was noticed that the following expression for 
\begin_inset Formula $a$
\end_inset 

 behaves as desired.
 
\begin_inset Formula $a=\frac{\left(\overrightarrow{N_{1}}\times\overrightarrow{N_{2}}\right)\bullet\left(\overrightarrow{v_{1}}-\overrightarrow{v_{2}}\right)}{\left|\left(\overrightarrow{N_{1}}\times\overrightarrow{N_{2}}\right)\bullet\left(\overrightarrow{v_{1}}-\overrightarrow{v_{2}}\right)\right|}$
\end_inset 

 (Figure 
\begin_inset LatexCommand \ref{cap:Disambiguating--gamma}

\end_inset 

).
 Note this expression for 
\begin_inset Formula $a$
\end_inset 

 is undefined for 
\begin_inset Formula $\theta==0,\pi,2\pi$
\end_inset 

.
 Assuming 
\begin_inset Formula $\theta$
\end_inset 

can never be 0 or 
\begin_inset Formula $2\pi$
\end_inset 

, then the only remaining problem value is for 
\begin_inset Formula $\theta==\pi$
\end_inset 

.
\layout Standard


\begin_inset Float figure
placement H
wide false
collapsed false

\layout Standard


\begin_inset ERT
status Collapsed

\layout Standard

\backslash 
center
\end_inset 


\layout Standard


\begin_inset Graphics
	filename vertex_forces6.png

\end_inset 


\layout Caption


\begin_inset LatexCommand \label{cap:Disambiguating--gamma}

\end_inset 

Disambiguating 
\begin_inset Formula $\gamma$
\end_inset 

 and 
\begin_inset Formula $-\gamma$
\end_inset 

 using 
\begin_inset Formula $a$
\end_inset 

.
 (A) Vectors 
\begin_inset Formula $\overrightarrow{N_{1}}\times\overrightarrow{N_{2}}$
\end_inset 

 and 
\begin_inset Formula $\overrightarrow{v_{1}}-\overrightarrow{v_{2}}$
\end_inset 

 both point into the page, so their dot product is greater than zero.
 (B) Vector 
\begin_inset Formula $\overrightarrow{N_{1}}\times\overrightarrow{N_{2}}$
\end_inset 

 now points out of the page, so the dot product is now less than zero.
\end_inset 


\layout Subsection

Computing 
\begin_inset Formula $\gamma$
\end_inset 

 and force
\layout Standard

Since 
\begin_inset Formula $cos\phi=-cos\left(a\gamma\right)$
\end_inset 

 for 
\begin_inset Formula $0<\theta<2\pi$
\end_inset 

 and 
\begin_inset Formula $\theta!=\pi$
\end_inset 

, a Taylor series for cosine can be used to compute 
\begin_inset Formula $\gamma$
\end_inset 

.
 
\begin_inset Formula $-cos\phi=cos\left(a\gamma\right)=1-\frac{a^{2}\gamma^{2}}{2}+O\left(\gamma^{4}\right).$
\end_inset 

 Therefore 
\begin_inset Formula $\gamma=\frac{1}{a}\sqrt{2\left(1+cos\phi\right)}$
\end_inset 

.
 Returning to the expression for moment, we see that 
\begin_inset Formula $\left|\overrightarrow{M_{j}}\right|=k\gamma=\frac{k}{a}\sqrt{2\left(1+cos\phi\right)}$
\end_inset 

.
 But if 
\begin_inset Formula $\overrightarrow{M_{j}}=M_{j}x\hat{i}+M_{j}y\hat{j}+M_{j}z\hat{k}$
\end_inset 

, then 
\begin_inset Formula $\sqrt{\left(M_{j}x\right)^{2}+\left(M_{j}y\right)^{2}+\left(M_{j}z\right)^{2}}=\frac{k}{a}\sqrt{2\left(1+cos\phi\right)}$
\end_inset 

 and then 
\begin_inset Formula $\left(M_{j}x\right)^{2}+\left(M_{j}y\right)^{2}+\left(M_{j}z\right)^{2}=\left(\frac{k}{a}\right)^{2}\left(2+2os\phi\right)$
\end_inset 

.
 Unfortunately, we see that 
\begin_inset Formula $a$
\end_inset 

 is squared which throws away its sign information.
\the_end
